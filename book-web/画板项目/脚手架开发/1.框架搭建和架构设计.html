<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>脚手架框架搭建和架构设计 | Liawn&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <meta charset="UTF-8">
  <link rel="icon" href="/blog-vuepress/favicon.ico">
  <link rel="manifest" href="/blog-vuepress/manifest.json">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/blog-vuepress/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/blog-vuepress/safari-pinned-tab.svg" color="#ffffff">
  <meta name="msapplication-TileImage" content="/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    <meta name="description" content="用vuepress搭建的个人博客">
    <meta charset="UTF-8">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/blog-vuepress/assets/css/0.styles.2f620dda.css" as="style"><link rel="preload" href="/blog-vuepress/assets/js/app.34680ebc.js" as="script"><link rel="preload" href="/blog-vuepress/assets/js/2.1e7adb41.js" as="script"><link rel="preload" href="/blog-vuepress/assets/js/37.72ec58bc.js" as="script"><link rel="preload" href="/blog-vuepress/assets/js/38.cec9a03e.js" as="script"><link rel="prefetch" href="/blog-vuepress/assets/js/10.1e723314.js"><link rel="prefetch" href="/blog-vuepress/assets/js/100.311567ba.js"><link rel="prefetch" href="/blog-vuepress/assets/js/101.ef72e26e.js"><link rel="prefetch" href="/blog-vuepress/assets/js/102.c3759919.js"><link rel="prefetch" href="/blog-vuepress/assets/js/103.98e877a9.js"><link rel="prefetch" href="/blog-vuepress/assets/js/104.e27de6a0.js"><link rel="prefetch" href="/blog-vuepress/assets/js/105.3a1ef548.js"><link rel="prefetch" href="/blog-vuepress/assets/js/106.59ee0f92.js"><link rel="prefetch" href="/blog-vuepress/assets/js/107.e68abe87.js"><link rel="prefetch" href="/blog-vuepress/assets/js/108.8fcda232.js"><link rel="prefetch" href="/blog-vuepress/assets/js/109.422d008d.js"><link rel="prefetch" href="/blog-vuepress/assets/js/11.58bde1dd.js"><link rel="prefetch" href="/blog-vuepress/assets/js/110.f713fc26.js"><link rel="prefetch" href="/blog-vuepress/assets/js/111.58efaae4.js"><link rel="prefetch" href="/blog-vuepress/assets/js/112.c6bdfbe0.js"><link rel="prefetch" href="/blog-vuepress/assets/js/113.8dbd693e.js"><link rel="prefetch" href="/blog-vuepress/assets/js/114.8a85e37a.js"><link rel="prefetch" href="/blog-vuepress/assets/js/115.54a6972e.js"><link rel="prefetch" href="/blog-vuepress/assets/js/116.56b2d8b8.js"><link rel="prefetch" href="/blog-vuepress/assets/js/117.11470546.js"><link rel="prefetch" href="/blog-vuepress/assets/js/118.1a39e213.js"><link rel="prefetch" href="/blog-vuepress/assets/js/119.41f15fbd.js"><link rel="prefetch" href="/blog-vuepress/assets/js/12.613505ee.js"><link rel="prefetch" href="/blog-vuepress/assets/js/120.9ac14643.js"><link rel="prefetch" href="/blog-vuepress/assets/js/121.83954220.js"><link rel="prefetch" href="/blog-vuepress/assets/js/122.bef8fade.js"><link rel="prefetch" href="/blog-vuepress/assets/js/123.25446ff9.js"><link rel="prefetch" href="/blog-vuepress/assets/js/124.6acf9e60.js"><link rel="prefetch" href="/blog-vuepress/assets/js/125.42c6fb5e.js"><link rel="prefetch" href="/blog-vuepress/assets/js/126.b9b98daa.js"><link rel="prefetch" href="/blog-vuepress/assets/js/127.382eea79.js"><link rel="prefetch" href="/blog-vuepress/assets/js/13.75740994.js"><link rel="prefetch" href="/blog-vuepress/assets/js/14.febc6ec1.js"><link rel="prefetch" href="/blog-vuepress/assets/js/15.6e16849c.js"><link rel="prefetch" href="/blog-vuepress/assets/js/16.70db9d99.js"><link rel="prefetch" href="/blog-vuepress/assets/js/17.f098e403.js"><link rel="prefetch" href="/blog-vuepress/assets/js/18.21ad25ae.js"><link rel="prefetch" href="/blog-vuepress/assets/js/19.4b561714.js"><link rel="prefetch" href="/blog-vuepress/assets/js/20.8dae8a78.js"><link rel="prefetch" href="/blog-vuepress/assets/js/21.7d09e2a3.js"><link rel="prefetch" href="/blog-vuepress/assets/js/22.7838f809.js"><link rel="prefetch" href="/blog-vuepress/assets/js/23.2444198c.js"><link rel="prefetch" href="/blog-vuepress/assets/js/24.099866db.js"><link rel="prefetch" href="/blog-vuepress/assets/js/25.d059d716.js"><link rel="prefetch" href="/blog-vuepress/assets/js/26.243af3f2.js"><link rel="prefetch" href="/blog-vuepress/assets/js/27.97e455c9.js"><link rel="prefetch" href="/blog-vuepress/assets/js/28.97ce9b54.js"><link rel="prefetch" href="/blog-vuepress/assets/js/29.392d550e.js"><link rel="prefetch" href="/blog-vuepress/assets/js/3.49db6791.js"><link rel="prefetch" href="/blog-vuepress/assets/js/30.9161535d.js"><link rel="prefetch" href="/blog-vuepress/assets/js/31.46b99656.js"><link rel="prefetch" href="/blog-vuepress/assets/js/32.c2fd0854.js"><link rel="prefetch" href="/blog-vuepress/assets/js/33.3080b8a5.js"><link rel="prefetch" href="/blog-vuepress/assets/js/34.e15baec0.js"><link rel="prefetch" href="/blog-vuepress/assets/js/35.f144a7bd.js"><link rel="prefetch" href="/blog-vuepress/assets/js/36.e1175535.js"><link rel="prefetch" href="/blog-vuepress/assets/js/39.fc6f4606.js"><link rel="prefetch" href="/blog-vuepress/assets/js/4.eca03551.js"><link rel="prefetch" href="/blog-vuepress/assets/js/40.b74ded47.js"><link rel="prefetch" href="/blog-vuepress/assets/js/41.cee8cec1.js"><link rel="prefetch" href="/blog-vuepress/assets/js/42.7f4e1373.js"><link rel="prefetch" href="/blog-vuepress/assets/js/43.10c6d899.js"><link rel="prefetch" href="/blog-vuepress/assets/js/44.4f190d43.js"><link rel="prefetch" href="/blog-vuepress/assets/js/45.5c2f36ae.js"><link rel="prefetch" href="/blog-vuepress/assets/js/46.9a5337f5.js"><link rel="prefetch" href="/blog-vuepress/assets/js/47.161b10c1.js"><link rel="prefetch" href="/blog-vuepress/assets/js/48.93192e20.js"><link rel="prefetch" href="/blog-vuepress/assets/js/49.72ba1cc4.js"><link rel="prefetch" href="/blog-vuepress/assets/js/5.aacc9c46.js"><link rel="prefetch" href="/blog-vuepress/assets/js/50.bfc0c26a.js"><link rel="prefetch" href="/blog-vuepress/assets/js/51.05bbb696.js"><link rel="prefetch" href="/blog-vuepress/assets/js/52.84b5a67c.js"><link rel="prefetch" href="/blog-vuepress/assets/js/53.220715ca.js"><link rel="prefetch" href="/blog-vuepress/assets/js/54.d433d73f.js"><link rel="prefetch" href="/blog-vuepress/assets/js/55.f8221d0f.js"><link rel="prefetch" href="/blog-vuepress/assets/js/56.2ec79246.js"><link rel="prefetch" href="/blog-vuepress/assets/js/57.01a3b85e.js"><link rel="prefetch" href="/blog-vuepress/assets/js/58.9015a667.js"><link rel="prefetch" href="/blog-vuepress/assets/js/59.73311086.js"><link rel="prefetch" href="/blog-vuepress/assets/js/6.0c335663.js"><link rel="prefetch" href="/blog-vuepress/assets/js/60.976cf8cc.js"><link rel="prefetch" href="/blog-vuepress/assets/js/61.4a1c95f1.js"><link rel="prefetch" href="/blog-vuepress/assets/js/62.865f814a.js"><link rel="prefetch" href="/blog-vuepress/assets/js/63.0d882dec.js"><link rel="prefetch" href="/blog-vuepress/assets/js/64.c74f770a.js"><link rel="prefetch" href="/blog-vuepress/assets/js/65.0d5262a8.js"><link rel="prefetch" href="/blog-vuepress/assets/js/66.1cd8fc00.js"><link rel="prefetch" href="/blog-vuepress/assets/js/67.a73db0e8.js"><link rel="prefetch" href="/blog-vuepress/assets/js/68.2fe7b184.js"><link rel="prefetch" href="/blog-vuepress/assets/js/69.763746bf.js"><link rel="prefetch" href="/blog-vuepress/assets/js/7.09a81cb8.js"><link rel="prefetch" href="/blog-vuepress/assets/js/70.2f10d153.js"><link rel="prefetch" href="/blog-vuepress/assets/js/71.f0476a16.js"><link rel="prefetch" href="/blog-vuepress/assets/js/72.b3aa24c4.js"><link rel="prefetch" href="/blog-vuepress/assets/js/73.d90b4378.js"><link rel="prefetch" href="/blog-vuepress/assets/js/74.5f3afc25.js"><link rel="prefetch" href="/blog-vuepress/assets/js/75.610a9393.js"><link rel="prefetch" href="/blog-vuepress/assets/js/76.397a07d0.js"><link rel="prefetch" href="/blog-vuepress/assets/js/77.a7a16098.js"><link rel="prefetch" href="/blog-vuepress/assets/js/78.0a76e3c0.js"><link rel="prefetch" href="/blog-vuepress/assets/js/79.d9bf3b6d.js"><link rel="prefetch" href="/blog-vuepress/assets/js/8.7a4382cf.js"><link rel="prefetch" href="/blog-vuepress/assets/js/80.6653af85.js"><link rel="prefetch" href="/blog-vuepress/assets/js/81.7bfd7632.js"><link rel="prefetch" href="/blog-vuepress/assets/js/82.e5ec57b6.js"><link rel="prefetch" href="/blog-vuepress/assets/js/83.7728c890.js"><link rel="prefetch" href="/blog-vuepress/assets/js/84.dd67c36e.js"><link rel="prefetch" href="/blog-vuepress/assets/js/85.7387a0e5.js"><link rel="prefetch" href="/blog-vuepress/assets/js/86.bbfe7f7f.js"><link rel="prefetch" href="/blog-vuepress/assets/js/87.2de3f2a7.js"><link rel="prefetch" href="/blog-vuepress/assets/js/88.809122f0.js"><link rel="prefetch" href="/blog-vuepress/assets/js/89.321e8e47.js"><link rel="prefetch" href="/blog-vuepress/assets/js/9.26929067.js"><link rel="prefetch" href="/blog-vuepress/assets/js/90.5ce6c826.js"><link rel="prefetch" href="/blog-vuepress/assets/js/91.075154c5.js"><link rel="prefetch" href="/blog-vuepress/assets/js/92.11b94685.js"><link rel="prefetch" href="/blog-vuepress/assets/js/93.a9d4d5f0.js"><link rel="prefetch" href="/blog-vuepress/assets/js/94.306ece7e.js"><link rel="prefetch" href="/blog-vuepress/assets/js/95.817525f6.js"><link rel="prefetch" href="/blog-vuepress/assets/js/96.beed2305.js"><link rel="prefetch" href="/blog-vuepress/assets/js/97.b4c539f2.js"><link rel="prefetch" href="/blog-vuepress/assets/js/98.8e445314.js"><link rel="prefetch" href="/blog-vuepress/assets/js/99.558669ea.js">
    <link rel="stylesheet" href="/blog-vuepress/assets/css/0.styles.2f620dda.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><a href="/blog-vuepress/" class="home-link router-link-active"><!----> <span class="site-name">Liawn's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog-vuepress/book-web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/blog-vuepress/book-sketches/" class="nav-link">
  生活
</a></div> <!----></nav></div></header> <div class="sidebar-wrapper sidebar-hidden"><aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog-vuepress/book-web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/blog-vuepress/book-sketches/" class="nav-link">
  生活
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span>web前端</span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/html、css、js、ts/学习JavaScript/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>学习JavaScript</span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/html、css、js、ts/学习CSS/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>学习CSS</span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/html、css、js、ts/学习TypeScript/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>学习TypeScript</span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/web前端js框架/学习Vue/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>学习Vue</span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/web前端js框架/学习React/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>学习React</span></a> <!----></section></li><li><a href="/blog-vuepress/book-web/web前端js框架/学习jQuery.html" class="sidebar-link">jQueryNote</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/LayaBox游戏引擎/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>H5游戏引擎Laya</span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span>常用工具</span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog-vuepress/book-web/常用工具/Npm的使用.html" class="sidebar-link">Npm 的使用</a></li><li><a href="/blog-vuepress/book-web/常用工具/Git的使用.html" class="sidebar-link">Git 的使用</a></li><li><a href="/blog-vuepress/book-web/常用工具/webpack的使用.html" class="sidebar-link">webpack 的使用</a></li><li><a href="/blog-vuepress/book-web/常用工具/VSCode的使用.html" class="sidebar-link">VSCode 的使用</a></li><li><a href="/blog-vuepress/book-web/常用工具/Chrome的使用.html" class="sidebar-link">Chrome 的使用</a></li><li><a href="/blog-vuepress/book-web/常用工具/使用vuepress写blog.html" class="sidebar-link">使用 vuepress 写 blog</a></li><li><a href="/blog-vuepress/book-web/常用工具/使用docsify写blog.html" class="sidebar-link">使用 docsify 写 blog</a></li><li><a href="/blog-vuepress/book-web/常用工具/使用gitbook写blog.html" class="sidebar-link">使用 gitbook 写 blog</a></li><li><a href="/blog-vuepress/book-web/web前端测试与调试/基于mocha+chai的单元测试.html" class="sidebar-link">使用 mocha+chai 进行单元测试</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span>Web后端</span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/web后端/学习node.js/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>学习node.js</span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/web后端/学习python/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>学习python</span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span>简单项目实践</span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/项目/react+express+ts写爬虫/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>react+express+ts写爬虫</span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span>数据结构与算法</span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog-vuepress/book-web/数据结构与算法/" class="sidebar-heading clickable"><span class="arrow right"></span> <span>数据结构与算法ts版</span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span>面试准备</span></p> <!----></section></li></ul> </aside> <div class="sidebar-toggle" data-v-10bfdc0c><div class="sidebar-toggle-button" data-v-10bfdc0c><span data-v-10bfdc0c></span><span data-v-10bfdc0c></span><span data-v-10bfdc0c></span></div></div></div> <main class="page sidebar-hidden right-sidebar-hidden"> <div class="theme-default-content content__default"><h1 id="脚手架框架搭建和架构设计"><a href="#脚手架框架搭建和架构设计" class="header-anchor">#</a> 脚手架框架搭建和架构设计</h1> <h2 id="脚手架开发入门"><a href="#脚手架开发入门" class="header-anchor">#</a> 脚手架开发入门</h2> <h3 id="脚手架简介"><a href="#脚手架简介" class="header-anchor">#</a> 脚手架简介</h3> <p>脚手架本质是一个“操作系统”的客户端，它通过命令行执行，例如</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>vue create vue-test-app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面这条命令由 3 个部分组成：</p> <ul><li>主命令：vue</li> <li>command：create</li> <li>command 的 param：vue-test-app</li></ul> <p>它表示创建一个 vue 项目，项目的名称为<code>vue-test-app</code>，以上是一个较为简单的脚手架命令，但实际场景往往更加复杂，比如：</p> <p>当前目录已经有文件了，我们需要覆盖当前目录下的文件，强制进行安装<code>vue</code>项目，此时我们就可以输入：</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>vue create vue-test-app --force
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里的<code>--force</code>叫做<code>option</code>，用来辅助脚手架确认在特定场景下用户的选择（可以理解为配置）。还有一种场景：</p> <p>通过<code>vue create</code>创建项目时，会自动执行<code>npm install</code>帮用户安装依赖，如果我们希望使用淘宝源来安装，可以输入命令：</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>vue create vue-test-app --force -r http://registry.npm.taobao.org
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里的<code>-r</code>也叫做<code>option</code>，它与<code>--force</code>不同的是它使用<code>-</code>，并且使用简写，这里的<code>-r</code>也可以替换成<code>--registry</code>。其实可以输入以下命令来查看<code>vue create</code>支持的所有<code>options</code></p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>vue create --help
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>-r http://registry.npm.taobao.org</code>后面的路径是<code>option</code>的<code>param</code>，其实<code>--force</code>可以理解为<code>--force true</code>，简写为<code>--force</code>或<code>-f</code>。</p> <h3 id="脚手架的执行原理"><a href="#脚手架的执行原理" class="header-anchor">#</a> 脚手架的执行原理</h3> <p>那么输入完<code>vue create vue-test-app</code>，终端是如何处理的呢？</p> <p><img src="/blog-vuepress/assets/img/环境变量npm.f8e54f41.png" alt="环境变量npm"></p> <p>终端会通过<strong>npm 环境变量</strong>（如上图）来找到<code>vue</code>这个主命令。我们可以在终端中输入<code>which vue</code>来找到这个<code>vue</code>指令存储在哪。输入输出如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">which</span> vue
/c/Users/Administrator/AppData/Roaming/npm/vue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>根据这个<code>/c/Users/Administrator/AppData/Roaming/npm/vue</code>输出（也有可能是<code>/d/nodejs/vue</code>），我们可以打开我们电脑本地这个目录，目录内容如下。</p> <p><img src="/blog-vuepress/assets/img/找到vue指令.e77247cb.png" alt="找到vue指令"></p> <p>有三个同名<code>vue</code>文件，是操作系统里的<strong>可执行脚本</strong>，表示可以用<code>minTTY</code>(Git Bash)、<code>winpty</code>(cmd)、<code>PowerShell</code>分别打开这三个文件，它们似乎都在用<code>node</code>来<strong>运行</strong>同目录下的<code>node_modules/@vue/cli/bin/vue.js</code>。</p> <p>题外话，如果用到的是 yarn 安装的 v-cli，那么它的目录是<code>C:\Users\liawn\AppData\Local\Yarn\Data\global\node_modules</code>，至于命令则是在<code>C:\Users\liawn\AppData\Local\Yarn\Data\global\node_modules\.bin</code>。</p> <p>这里的<code>node_modules</code>是全局依赖包安装的地方，你可以回想一下当时安装<code>v-cli</code>脚手架的命令是不是<code>npm install -g @vue/cli</code>。我们继续找到并打开<code>node_modules/@vue/cli/bin/vue.js</code>，会发现里面有我们非常熟悉的<code>create</code>、<code>serve</code>、<code>build</code>等命令（方法），以下是抽取了部分代码块。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> chalk<span class="token punctuation">,</span> semver <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vue/cli-shared-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> requiredVersion <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../package.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>engines<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
<span class="token keyword">const</span> leven <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;leven&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkNodeVersion</span><span class="token punctuation">(</span><span class="token parameter">wanted<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>semver<span class="token punctuation">.</span><span class="token function">satisfies</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>version<span class="token punctuation">,</span> wanted<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">includePrerelease</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 省略...</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">checkNodeVersion</span><span class="token punctuation">(</span>requiredVersion<span class="token punctuation">,</span> <span class="token string">&quot;@vue/cli&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">EOL_NODE_MAJORS</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;8.x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;9.x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;11.x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;13.x&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> major <span class="token keyword">of</span> <span class="token constant">EOL_NODE_MAJORS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>semver<span class="token punctuation">.</span><span class="token function">satisfies</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>version<span class="token punctuation">,</span> major<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 省略...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> slash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;slash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> minimist <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;minimist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>
  <span class="token function">slash</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;/packages/test&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
  <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;../@vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;../../@vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_CLI_DEBUG</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;commander&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> loadCommand <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../lib/util/loadCommand&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
program<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@vue/cli </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../package&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;command&gt; [options]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;create &lt;app-name&gt;&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;-r, --registry &lt;url&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Use specified npm registry when installing dependencies (only for npm)&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;-f, --force&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Overwrite target directory if it exists&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">minimist</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>
          <span class="token string">&quot;\n Info: You provided more than one argument. The first one will be used as the app's name, the rest are ignored.&quot;</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;-g&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;--git&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>forceGit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../lib/create&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;serve [entry]&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;-o, --open&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Open browser&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entry<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">loadCommand</span><span class="token punctuation">(</span><span class="token string">&quot;serve&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@vue/cli-service-global&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> <span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;build [entry]&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">&quot;-t, --target &lt;target&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Build target (app | lib | wc | wc-async, default: app)&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entry<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">loadCommand</span><span class="token punctuation">(</span><span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@vue/cli-service-global&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> <span class="token function">cleanArgs</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 省略...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>在总结“脚手架执行原理”之前先说一个细节，<code>bin/vue.js</code>的最顶部有一行<code>#!/usr/bin/env node</code>代码，它的作用是什么呢？<code>#!/usr/bin/env node</code>可以帮助<code>bin/vue.js</code>找到<strong>系统变量</strong>里的 node.exe，那么就可以直接用<code>./vue.js create test-app</code>来创建一个 vue 项目。</p> <p><img src="/blog-vuepress/assets/img/vue.js直接运行.6151f8cd.png" alt="vue.js直接运行"></p> <p>这是因为在 Linux 等系统下用<code>ln -s vue bin/vue.js</code>类似的命令给<code>bin/vue.js</code>生成了一个<strong>软链接</strong>，将这个软链接放到了<strong>npm 环境变量</strong>中，供其他人直接使用<code>vue</code>指令，而 Windows 系统下的软链接其实是“<strong>快捷方式</strong>”，但是你也看到上面的三个<code>vue</code>指令并不是快捷方式而是系统可执行文件。也就是说在<strong>不同的系统</strong>里，在<strong>不同的终端</strong>里，<strong>最终</strong>都是要去执行<code>node_modules/@vue/cli/bin/vue.js</code>。</p> <p><strong>脚手架执行原理</strong>总的来说就是：</p> <ul><li><code>v-cli</code>脚手架在<strong>npm 环境变量</strong>对应的目录下存放了<strong>软链接</strong>或者<strong>可执行脚本</strong>，那么就可以在操作系统各处都可以运行<code>vue</code>指令了。</li> <li><code>vue</code>指令的功能是运行 npm 全局依赖包<code>v-cli</code>里的<code>bin/vue.js</code>，具体是通过调用本地的<strong>node</strong>执行 js 的。</li> <li>最后根据<code>vue command param</code>里携带的<code>command</code>和<code>param</code>来运行<code>bin/vue.js</code>里对应的程序块。</li></ul> <h3 id="脚手架开发流程及难点"><a href="#脚手架开发流程及难点" class="header-anchor">#</a> 脚手架开发流程及难点</h3> <p>开发流程：</p> <ul><li>创建 npm 项目</li> <li>创建脚手架入口文件，最上方添加：<code>#!/usr/bin/env node</code></li> <li>配置 package.json，添加 bin 属性</li> <li>编写脚手架代码</li> <li>将脚手架发布到 npm</li></ul> <p>开发难点：</p> <ul><li><p>分包：将复杂的系统拆分成若干个模块</p></li> <li><p>命令注册：例</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>vue create
vue add
vue invoke
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>参数解析：<code>vue command [options] &lt;params&gt;</code></p> <ul><li><p>options 全称：<code>--version</code>、<code>--help</code></p></li> <li><p>options 简写：<code>-V</code>、<code>-h</code></p></li> <li><p>带 params 的 options：<code>--path /Users/caimengxin/Desktop/vue-test</code></p></li> <li><p>帮助文档：</p> <ul><li><p>global help</p> <ul><li>Usage</li> <li>Options</li> <li>Commands</li></ul></li> <li><p>示例，vue 的帮助信息：</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>Usage: vue &lt;command&gt; [options]

Options:
-V, --version                              output the version number
-h, --help                                 output usage information

Commands:
create [options] &lt;app-name&gt;                create a new project powered by vue-cli-service
add [options] &lt;plugin&gt; [pluginOptions]     install a plugin and invoke its generator in an already created project
// ...省略
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul></li></ul></li> <li><p>命令行交互</p></li> <li><p>日志打印</p></li> <li><p>命令行文字变色</p></li> <li><p>网络通信：HTTP、WebSocket</p></li> <li><p>文件处理</p></li></ul> <h3 id="开发一个脚手架-demo"><a href="#开发一个脚手架-demo" class="header-anchor">#</a> 开发一个脚手架 demo</h3></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main> <div class="right-sidebar-wrapper right-sidebar-hidden"><aside class="right-sidebar"><div><div class="title">本文目录</div><h1><a href="/blog-vuepress/book-web/%E7%94%BB%E6%9D%BF%E9%A1%B9%E7%9B%AE/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91/1.%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA%E5%92%8C%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html#脚手架框架搭建和架构设计" title="脚手架框架搭建和架构设计">脚手架框架搭建和架构设计</a></h1><h2><a href="/blog-vuepress/book-web/%E7%94%BB%E6%9D%BF%E9%A1%B9%E7%9B%AE/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91/1.%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA%E5%92%8C%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html#脚手架开发入门" title="脚手架开发入门">脚手架开发入门</a></h2><h3><a href="/blog-vuepress/book-web/%E7%94%BB%E6%9D%BF%E9%A1%B9%E7%9B%AE/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91/1.%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA%E5%92%8C%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html#脚手架简介" title="脚手架简介">脚手架简介</a></h3><h3><a href="/blog-vuepress/book-web/%E7%94%BB%E6%9D%BF%E9%A1%B9%E7%9B%AE/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91/1.%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA%E5%92%8C%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html#脚手架的执行原理" title="脚手架的执行原理">脚手架的执行原理</a></h3><h3><a href="/blog-vuepress/book-web/%E7%94%BB%E6%9D%BF%E9%A1%B9%E7%9B%AE/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91/1.%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA%E5%92%8C%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html#脚手架开发流程及难点" title="脚手架开发流程及难点">脚手架开发流程及难点</a></h3><h3><a href="/blog-vuepress/book-web/%E7%94%BB%E6%9D%BF%E9%A1%B9%E7%9B%AE/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91/1.%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA%E5%92%8C%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html#开发一个脚手架-demo" title="开发一个脚手架 demo">开发一个脚手架 demo</a></h3></div></aside> <div class="sidebar-toggle" data-v-10bfdc0c><div class="sidebar-toggle-button" data-v-10bfdc0c><span data-v-10bfdc0c></span><span data-v-10bfdc0c></span><span data-v-10bfdc0c></span></div></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/blog-vuepress/assets/js/app.34680ebc.js" defer></script><script src="/blog-vuepress/assets/js/2.1e7adb41.js" defer></script><script src="/blog-vuepress/assets/js/37.72ec58bc.js" defer></script><script src="/blog-vuepress/assets/js/38.cec9a03e.js" defer></script>
  </body>
</html>
