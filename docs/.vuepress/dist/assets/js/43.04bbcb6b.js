(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{293:function(s,e,r){s.exports=r.p+"assets/img/frp开放安全组端口.2e6b66c0.png"},637:function(s,e,r){"use strict";r.r(e);var t=r(13),a=Object(t.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"frp实现内网穿透"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#frp实现内网穿透"}},[s._v("#")]),s._v(" Frp实现内网穿透")]),s._v(" "),t("h2",{attrs:{id:"云服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#云服务器"}},[s._v("#")]),s._v(" 云服务器")]),s._v(" "),t("p",[s._v("暂时使用的是"),t("a",{attrs:{href:"https://www.aliyun.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("阿里云"),t("OutboundLink")],1),s._v("的"),t("a",{attrs:{href:"https://www.aliyun.com/product/ecs",target:"_blank",rel:"noopener noreferrer"}},[s._v("云服务器ECS"),t("OutboundLink")],1),s._v("，轻量应用服务器、ECS通用型、ECS共享型都可以。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://bandwagonhost.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("搬瓦工"),t("OutboundLink")],1),s._v("和"),t("a",{attrs:{href:"https://www.vultr.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("vultr"),t("OutboundLink")],1),s._v("也可以。")]),s._v(" "),t("h2",{attrs:{id:"使用frp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用frp"}},[s._v("#")]),s._v(" 使用frp")]),s._v(" "),t("h3",{attrs:{id:"下载frp到服务端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载frp到服务端"}},[s._v("#")]),s._v(" 下载frp到服务端")]),s._v(" "),t("p",[s._v("在阿里云的"),t("a",{attrs:{href:"https://ecs.console.aliyun.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("云服务器ECS控制台"),t("OutboundLink")],1),s._v("里，我们点击云服务器的"),t("strong",[s._v("远程连接")]),s._v("，进入服务端控制台。")]),s._v(" "),t("p",[s._v("输入"),t("code",[s._v("cd /usr/local")]),s._v("进入个人默认的程序安装路径，输入"),t("code",[s._v("arch")]),s._v("查看处理器的架构，根据这个架构去"),t("a",{attrs:{href:"https://github.com/fatedier/frp/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("frp的GitHub"),t("OutboundLink")],1),s._v("里选择合适的版本。")]),s._v(" "),t("p",[s._v("由于是"),t("code",[s._v("x86_64")]),s._v("所以我们选择amd64版本，输入"),t("code",[s._v("wget https://github.com/fatedier/frp/releases/download/v0.35.0/frp_0.35.0_linux_amd64.tar.gz")]),s._v("将frp下载到服务端。如果"),t("code",[s._v("/usr/local")]),s._v("里已经有了frp，是可以输入"),t("code",[s._v("rm -rf frp")]),s._v("进行删除的。")]),s._v(" "),t("p",[s._v("输入"),t("code",[s._v("tar -zxvf frp_0.35.0_linux_amd64.tar.gz")]),s._v("对frp的压缩包进行解压，输入"),t("code",[s._v("rm frp_0.35.0_linux_amd64.tar.gz")]),s._v("对压缩包进行删除（输入"),t("code",[s._v("yes")]),s._v("确认删除），输入"),t("code",[s._v("mv frp_0.35.0_linux_amd64 frp")]),s._v("对解压出来的文件夹进行重命名。")]),s._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[s._v("cd /usr/local\nwget https://github.com/fatedier/frp/releases/download/v0.35.0/frp_0.35.0_linux_amd64.tar.gz\ntar -zxvf frp_0.35.0_linux_amd64.tar.gz\nrm frp_0.35.0_linux_amd64.tar.gz\nmv frp_0.35.0_linux_amd64 frp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"配置服务端里的frp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置服务端里的frp"}},[s._v("#")]),s._v(" 配置服务端里的frp")]),s._v(" "),t("p",[s._v("输入"),t("code",[s._v("cd frp")]),s._v("进入服务端的frp，输入"),t("code",[s._v("rm frpc")]),s._v("、"),t("code",[s._v("rm frpc.ini")]),s._v("和"),t("code",[s._v("rm frpc_full.ini")]),s._v("是为了删除客户端的东西，在服务端是用不着的。")]),s._v(" "),t("p",[s._v("要配置一下frps.ini。输入"),t("code",[s._v("vim frps.ini")]),s._v("，再输入"),t("code",[s._v("i")]),s._v("进入输入模式，输入以下内容：")]),s._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[s._v("[common]\nbind_port = 7000\ntoken = 88888888\ndashboard_port = 7500\ndashboard_user = admin\ndashboard_pwd = admin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("按Esc退出输入模式，输入"),t("code",[s._v(":wq")]),s._v("退出并保存。上面的"),t("code",[s._v("bind_port")]),s._v("是frp监听端口，"),t("code",[s._v("dashboard_port")]),s._v("是控制页面对应端口，"),t("code",[s._v("token")]),s._v("是服务端与客户端通信的令牌，"),t("code",[s._v("dashboard_user")]),s._v("是进入控制页面的账户，"),t("code",[s._v("dashboard_pwd")]),s._v("是进入控制页面账户对应的密码。"),t("code",[s._v("dashboard_xxx")]),s._v("不是特别重要，最重要的是"),t("code",[s._v("bind_port")]),s._v("和"),t("code",[s._v("token")]),s._v("。")]),s._v(" "),t("p",[s._v("我们要让frp在服务端开机自运行。输入"),t("code",[s._v("vim /etc/systemd/system/frps.service")]),s._v("，再输入"),t("code",[s._v("i")]),s._v("进入输入模式，输入以下内容：")]),s._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[s._v("[Unit]\nDescription=frps daemon\nAfter=syslog.target  network.target\nWants=network.target\n\n[Service]\nType=simple\nExecStart=/usr/local/frp/frps -c /usr/local/frp/frps.ini\nRestart=always\nRestartSec=1min\n\n[Install]\nWantedBy=multi-user.target\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("按Esc退出输入模式，输入"),t("code",[s._v(":wq")]),s._v("退出并保存。最后输入"),t("code",[s._v("systemctl start frps && systemctl enable frps")]),s._v("就设置好了开机启动。")]),s._v(" "),t("p",[s._v("可以让服务端停止后再启动，然后输入"),t("code",[s._v("netstat -tanlp")]),s._v("查看进程（杀进程使用"),t("code",[s._v("kill -9 xxx")]),s._v("）。")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 刷新服务列表\nsystemctl daemon-reload\n# 设置开机自启\nsystemctl enable frps\n# 关闭开机自启\nsystemctl disable frps\n# 启动服务\nsystemctl start frps\n# 停止服务\nsystemctl stop frps\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"配置客户端里的frp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置客户端里的frp"}},[s._v("#")]),s._v(" 配置客户端里的frp")]),s._v(" "),t("p",[s._v("去"),t("a",{attrs:{href:"https://github.com/fatedier/frp/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("frp的GitHub"),t("OutboundLink")],1),s._v("里选择相应的版本，比如windows我们暂时使用的是"),t("code",[s._v("frp_0.35.0_windows_amd64.zip")]),s._v("，下载解压到本地某个目录下，删除"),t("code",[s._v("frps")]),s._v("、"),t("code",[s._v("frps.ini")]),s._v("和"),t("code",[s._v("frps_full.ini")]),s._v("与客户端无关的文件。使用文本编辑器打开"),t("code",[s._v("frpc.ini")]),s._v("编辑如下")]),s._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[s._v("[common]\nserver_addr = 139.224.248.233\nserver_port = 7000\ntoken = 88888888\n\n[rdc]\ntype = tcp\nlocal_ip = 127.0.0.1\nlocal_port = 3389\nremote_port = 3360\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("上面的"),t("code",[s._v("server_addr = 139.224.248.233")]),s._v("是frps服务端所在的云服务器的公网IP（阿里云ECS实例公网IP）；"),t("code",[s._v("server_port = 7000")]),s._v("是frps服务端所依赖的端口，frpc和frps之间的连接就依赖于这个"),t("code",[s._v("7000")]),s._v("端口；"),t("code",[s._v("token = 88888888")]),s._v("是frpc和frps之间的通信令牌，在frps也同样设置过了；"),t("code",[s._v("[rdc]")]),s._v("是自定义名字；"),t("code",[s._v("type = tcp")]),s._v("是因为我们使用"),t("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/windows-server/remote/remote-desktop-services/clients/remote-desktop-clients",target:"_blank",rel:"noopener noreferrer"}},[s._v("RD Client"),t("OutboundLink")],1),s._v("，它是tcp类型的；"),t("code",[s._v("local_ip= 127.0.0.1")]),s._v("是本地机器IP（暂时就填默认的"),t("code",[s._v("127.0.0.1")]),s._v("）；"),t("code",[s._v("local_port = 3389")]),s._v("是你要映射本地机器的哪个端口，因为要使用RD Client，所以是"),t("code",[s._v("3389")]),s._v("端口；"),t("code",[s._v("remote_port = 3360")]),s._v("表示将本地的那个端口要映射到远程frps所在服务器的哪个端口，总的来说就是将本地的"),t("code",[s._v("3389")]),s._v("端口映射到"),t("code",[s._v("139.xxx.xxx.xxx")]),s._v("的"),t("code",[s._v("3360")]),s._v("端口。")]),s._v(" "),t("p",[s._v("我们需要在电脑开机时自动运行客户端的frp。在frp目录下新建startfrpc.bat批处理文件，使用文本编辑器打开并编辑：")]),s._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[s._v('@echo off\n:: 定义WIFI名称\nset wifi_name=TP-LINK_602\n:: 连接WIFI，查看当前连接信息，并且是否是wifi_name\n(netsh WLAN show interfaces | findStr %wifi_name% >nul) || (\n    :: ||表示否则，意味着当前连接不是wifi_name，那就netsh wlan connect连接wifi_name\n    netsh wlan connect ssid=%wifi_name% name=%wifi_name%\n)\n:: 延迟2秒\ntimeout /t 2 /nobreak\n:: 得确保联网后再运行frpc，看是否已经启动了frpc，>nul表示前面这句信息不输出到cmd框\n(tasklist|findstr "frp" >nul) || (\n    :: 没有启动frpc，就在这启动frpc，||表示否则\n    d:\\frp_0.35.0_windows_amd64\\frpc.exe -c d:\\frp_0.35.0_windows_amd64\\frpc.ini\n)\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("我们将startfrpc.bat加入到任务计划程序。打开电脑的“任务计划程序”，选择右侧的“创建任务...”。")]),s._v(" "),t("ul",[t("li",[s._v("在常规这个页签里，名称填为“frpc”，然后勾上“不管用户是否登录都要运行”、“使用最高权限运行”、“隐藏”。")]),s._v(" "),t("li",[s._v("在触发器这个页签里，选择新建，然后开始任务选择“启动时”，可以自己选择是否重复执行以及间隔。")]),s._v(" "),t("li",[s._v("在操作这个页签里，选择新建，然后点击“浏览”选择前面创建的“start.bat”（D:\\frp_0.35.0_windows_amd64\\start.bat），最后在“起始于”里填写start.bat的父路径（D:\\frp_0.35.0_windows_amd64）。")]),s._v(" "),t("li",[s._v("返回常规页签，然后点击确定，输入电脑登录密码，就完成了frpc的自启动。")])]),s._v(" "),t("h3",{attrs:{id:"给云服务器设置安全组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#给云服务器设置安全组"}},[s._v("#")]),s._v(" 给云服务器设置安全组")]),s._v(" "),t("p",[s._v("云服务器"),t("strong",[s._v("内部")]),s._v("的frps依赖的"),t("code",[s._v("7000")]),s._v("可以不用管，因为你在服务器命令行里输入"),t("code",[s._v("firewall-cmd --state")]),s._v("，会发现阿里云服务器操作系统内的防火墙是默认关闭的，所以内部使用"),t("code",[s._v("7000")]),s._v("端口可以不用管了。如果你要放开云服务器本身的防火墙并添加"),t("code",[s._v("7000")]),s._v("端口，可以参考如下命令。")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 先查看防火墙状态\nfirewall-cmd --state\n# 启用防火墙\nsystemctl start firewalld\n# 停用防火墙\nsystemctl stop firewalld\nfirewall-cmd --zone=public --add-port=7000/udp --permanent \nfirewall-cmd --zone=public --add-port=7000/tcp --permanent \n# 放行端口后要重新加载\nfirewall-cmd --reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("而"),t("strong",[s._v("外部")]),s._v("想访问服务器以及它的一些端口，那就必须放开一些端口，这个是在"),t("a",{attrs:{href:"https://ecs.console.aliyun.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("阿里云控制台"),t("OutboundLink")],1),s._v("——网络与安全——安全组。frpc所在机器想与云服务里的frps进行通信连接，需要开放云服务器安全组的"),t("code",[s._v("7000")]),s._v("给外部用；然后我们要使用RDClient进行远程桌面控制，通过frp将"),t("code",[s._v("3389")]),s._v("映射到云服务器的"),t("code",[s._v("3360")]),s._v("端口了，那么还需要开放云服务器安全组的"),t("code",[s._v("3360")]),s._v("给外部用。"),t("code",[s._v("7000")]),s._v("和"),t("code",[s._v("3360")]),s._v("开放给谁，也要限定好，不是谁想加就加的。")]),s._v(" "),t("p",[t("img",{attrs:{src:r(293),alt:"安全组"}})]),s._v(" "),t("p",[s._v("安全组的授权对象我们使用的是"),t("a",{attrs:{href:"https://ecs.console.aliyun.com/#/prefixList/cn-shanghai",target:"_blank",rel:"noopener noreferrer"}},[s._v("前缀列表"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"说在最后"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#说在最后"}},[s._v("#")]),s._v(" 说在最后")]),s._v(" "),t("p",[s._v("使用Frp还是挺简单的，但是它的安全性还是有些差，功能上也只是反向代理、映射端口，如果想异地组网（虚拟局域网）那就不能使用Frp了，可以使用"),t("RouterLink",{attrs:{to:"/book-sketches/电脑工具/SoftEther实现虚拟局域网.html"}},[s._v("SoftEther实现虚拟局域网")])],1)])}),[],!1,null,null,null);e.default=a.exports}}]);