(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{300:function(e,r,s){e.exports=s.p+"assets/img/frp开放安全组端口.2e6b66c0.png"},687:function(e,r,s){"use strict";s.r(r);var t=s(16),a=Object(t.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"frp-实现内网穿透"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#frp-实现内网穿透"}},[e._v("#")]),e._v(" Frp 实现内网穿透")]),e._v(" "),t("h2",{attrs:{id:"云服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#云服务器"}},[e._v("#")]),e._v(" 云服务器")]),e._v(" "),t("p",[e._v("暂时使用的是"),t("a",{attrs:{href:"https://www.aliyun.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("阿里云"),t("OutboundLink")],1),e._v("的"),t("a",{attrs:{href:"https://www.aliyun.com/product/ecs",target:"_blank",rel:"noopener noreferrer"}},[e._v("云服务器 ECS"),t("OutboundLink")],1),e._v("，轻量应用服务器、ECS 通用型、ECS 共享型都可以。")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://bandwagonhost.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("搬瓦工"),t("OutboundLink")],1),e._v("和"),t("a",{attrs:{href:"https://www.vultr.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("vultr"),t("OutboundLink")],1),e._v("也可以。")]),e._v(" "),t("h2",{attrs:{id:"使用-frp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-frp"}},[e._v("#")]),e._v(" 使用 frp")]),e._v(" "),t("h3",{attrs:{id:"下载-frp-到服务端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载-frp-到服务端"}},[e._v("#")]),e._v(" 下载 frp 到服务端")]),e._v(" "),t("p",[e._v("在阿里云的"),t("a",{attrs:{href:"https://ecs.console.aliyun.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("云服务器 ECS 控制台"),t("OutboundLink")],1),e._v("里，我们点击云服务器的"),t("strong",[e._v("远程连接")]),e._v("，进入服务端控制台。")]),e._v(" "),t("p",[e._v("输入"),t("code",{pre:!0},[e._v("cd /usr/local")]),e._v("进入个人默认的程序安装路径，输入"),t("code",{pre:!0},[e._v("arch")]),e._v("查看处理器的架构，根据这个架构去"),t("a",{attrs:{href:"https://github.com/fatedier/frp/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("frp 的 GitHub"),t("OutboundLink")],1),e._v("里选择合适的版本。")]),e._v(" "),t("p",[e._v("由于是"),t("code",{pre:!0},[e._v("x86_64")]),e._v("所以我们选择 amd64 版本，输入"),t("code",{pre:!0},[e._v("wget https://github.com/fatedier/frp/releases/download/v0.35.0/frp_0.35.0_linux_amd64.tar.gz")]),e._v("将 frp 下载到服务端。如果"),t("code",{pre:!0},[e._v("/usr/local")]),e._v("里已经有了 frp，是可以输入"),t("code",{pre:!0},[e._v("rm -rf frp")]),e._v("进行删除的。")]),e._v(" "),t("p",[e._v("输入"),t("code",{pre:!0},[e._v("tar -zxvf frp_0.35.0_linux_amd64.tar.gz")]),e._v("对 frp 的压缩包进行解压，输入"),t("code",{pre:!0},[e._v("rm frp_0.35.0_linux_amd64.tar.gz")]),e._v("对压缩包进行删除（输入"),t("code",{pre:!0},[e._v("yes")]),e._v("确认删除），输入"),t("code",{pre:!0},[e._v("mv frp_0.35.0_linux_amd64 frp")]),e._v("对解压出来的文件夹进行重命名。")]),e._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[e._v("cd /usr/local\nwget https://github.com/fatedier/frp/releases/download/v0.35.0/frp_0.35.0_linux_amd64.tar.gz\ntar -zxvf frp_0.35.0_linux_amd64.tar.gz\nrm frp_0.35.0_linux_amd64.tar.gz\nmv frp_0.35.0_linux_amd64 frp\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("h3",{attrs:{id:"配置服务端里的-frp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置服务端里的-frp"}},[e._v("#")]),e._v(" 配置服务端里的 frp")]),e._v(" "),t("p",[e._v("输入"),t("code",{pre:!0},[e._v("cd frp")]),e._v("进入服务端的 frp，输入"),t("code",{pre:!0},[e._v("rm frpc")]),e._v("、"),t("code",{pre:!0},[e._v("rm frpc.ini")]),e._v("和"),t("code",{pre:!0},[e._v("rm frpc_full.ini")]),e._v("是为了删除客户端的东西，在服务端是用不着的。")]),e._v(" "),t("p",[e._v("要配置一下 frps.ini。输入"),t("code",{pre:!0},[e._v("vim frps.ini")]),e._v("，再输入"),t("code",{pre:!0},[e._v("i")]),e._v("进入输入模式，输入以下内容：")]),e._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[e._v("[common]\nbind_port = 7000\ntoken = 88888888\ndashboard_port = 7500\ndashboard_user = admin\ndashboard_pwd = admin\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("p",[e._v("按 Esc 退出输入模式，输入"),t("code",{pre:!0},[e._v(":wq")]),e._v("退出并保存。上面的"),t("code",{pre:!0},[e._v("bind_port")]),e._v("是 frp 监听端口，"),t("code",{pre:!0},[e._v("dashboard_port")]),e._v("是控制页面对应端口，"),t("code",{pre:!0},[e._v("token")]),e._v("是服务端与客户端通信的令牌，"),t("code",{pre:!0},[e._v("dashboard_user")]),e._v("是进入控制页面的账户，"),t("code",{pre:!0},[e._v("dashboard_pwd")]),e._v("是进入控制页面账户对应的密码。"),t("code",{pre:!0},[e._v("dashboard_xxx")]),e._v("不是特别重要，最重要的是"),t("code",{pre:!0},[e._v("bind_port")]),e._v("和"),t("code",{pre:!0},[e._v("token")]),e._v("。")]),e._v(" "),t("p",[e._v("我们要让 frp 在服务端开机自运行。输入"),t("code",{pre:!0},[e._v("vim /etc/systemd/system/frps.service")]),e._v("，再输入"),t("code",{pre:!0},[e._v("i")]),e._v("进入输入模式，输入以下内容：")]),e._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[e._v("[Unit]\nDescription=frps daemon\nAfter=syslog.target  network.target\nWants=network.target\n\n[Service]\nType=simple\nExecStart=/usr/local/frp/frps -c /usr/local/frp/frps.ini\nRestart=always\nRestartSec=1min\n\n[Install]\nWantedBy=multi-user.target\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br")])]),t("p",[e._v("按 Esc 退出输入模式，输入"),t("code",{pre:!0},[e._v(":wq")]),e._v("退出并保存。最后输入"),t("code",{pre:!0},[e._v("systemctl start frps && systemctl enable frps")]),e._v("就设置好了开机启动。")]),e._v(" "),t("p",[e._v("可以让服务端停止后再启动，然后输入"),t("code",{pre:!0},[e._v("netstat -tanlp")]),e._v("查看进程（杀进程使用"),t("code",{pre:!0},[e._v("kill -9 xxx")]),e._v("）。")]),e._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# 刷新服务列表\nsystemctl daemon-reload\n# 设置开机自启\nsystemctl enable frps\n# 关闭开机自启\nsystemctl disable frps\n# 启动服务\nsystemctl start frps\n# 停止服务\nsystemctl stop frps\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("h3",{attrs:{id:"配置客户端里的-frp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置客户端里的-frp"}},[e._v("#")]),e._v(" 配置客户端里的 frp")]),e._v(" "),t("p",[e._v("去"),t("a",{attrs:{href:"https://github.com/fatedier/frp/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("frp 的 GitHub"),t("OutboundLink")],1),e._v("里选择相应的版本，比如 windows 我们暂时使用的是"),t("code",{pre:!0},[e._v("frp_0.35.0_windows_amd64.zip")]),e._v("，下载解压到本地某个目录下，删除"),t("code",{pre:!0},[e._v("frps")]),e._v("、"),t("code",{pre:!0},[e._v("frps.ini")]),e._v("和"),t("code",{pre:!0},[e._v("frps_full.ini")]),e._v("与客户端无关的文件。使用文本编辑器打开"),t("code",{pre:!0},[e._v("frpc.ini")]),e._v("编辑如下")]),e._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[e._v("[common]\nserver_addr = 139.224.248.233\nserver_port = 7000\ntoken = 88888888\n\n[rdc]\ntype = tcp\nlocal_ip = 127.0.0.1\nlocal_port = 3389\nremote_port = 3360\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("p",[e._v("上面的"),t("code",{pre:!0},[e._v("server_addr = 139.224.248.233")]),e._v("是 frps 服务端所在的云服务器的公网 IP（阿里云 ECS 实例公网 IP）；"),t("code",{pre:!0},[e._v("server_port = 7000")]),e._v("是 frps 服务端所依赖的端口，frpc 和 frps 之间的连接就依赖于这个"),t("code",{pre:!0},[e._v("7000")]),e._v("端口；"),t("code",{pre:!0},[e._v("token = 88888888")]),e._v("是 frpc 和 frps 之间的通信令牌，在 frps 也同样设置过了；"),t("code",{pre:!0},[e._v("[rdc]")]),e._v("是自定义名字；"),t("code",{pre:!0},[e._v("type = tcp")]),e._v("是因为我们使用"),t("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/windows-server/remote/remote-desktop-services/clients/remote-desktop-clients",target:"_blank",rel:"noopener noreferrer"}},[e._v("RD Client"),t("OutboundLink")],1),e._v("，它是 tcp 类型的；"),t("code",{pre:!0},[e._v("local_ip= 127.0.0.1")]),e._v("是本地机器 IP（暂时就填默认的"),t("code",{pre:!0},[e._v("127.0.0.1")]),e._v("）；"),t("code",{pre:!0},[e._v("local_port = 3389")]),e._v("是你要映射本地机器的哪个端口，因为要使用 RD Client，所以是"),t("code",{pre:!0},[e._v("3389")]),e._v("端口；"),t("code",{pre:!0},[e._v("remote_port = 3360")]),e._v("表示将本地的那个端口要映射到远程 frps 所在服务器的哪个端口，总的来说就是将本地的"),t("code",{pre:!0},[e._v("3389")]),e._v("端口映射到"),t("code",{pre:!0},[e._v("139.xxx.xxx.xxx")]),e._v("的"),t("code",{pre:!0},[e._v("3360")]),e._v("端口。")]),e._v(" "),t("p",[e._v("我们需要在电脑开机时自动运行客户端的 frp。在 frp 目录下新建 startfrpc.bat 批处理文件，使用文本编辑器打开并编辑：")]),e._v(" "),t("div",{staticClass:"language-txt line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[e._v('@echo off\n:: 定义WIFI名称\nset wifi_name=TP-LINK_602\n:: 连接WIFI，查看当前连接信息，并且是否是wifi_name\n(netsh WLAN show interfaces | findStr %wifi_name% >nul) || (\n    :: ||表示否则，意味着当前连接不是wifi_name，那就netsh wlan connect连接wifi_name\n    netsh wlan connect ssid=%wifi_name% name=%wifi_name%\n)\n:: 延迟2秒\ntimeout /t 2 /nobreak\n:: 得确保联网后再运行frpc，看是否已经启动了frpc，>nul表示前面这句信息不输出到cmd框\n(tasklist|findstr "frp" >nul) || (\n    :: 没有启动frpc，就在这启动frpc，||表示否则\n    d:\\frp_0.35.0_windows_amd64\\frpc.exe -c d:\\frp_0.35.0_windows_amd64\\frpc.ini\n)\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br")])]),t("p",[e._v("我们将 startfrpc.bat 加入到任务计划程序。打开电脑的“任务计划程序”，选择右侧的“创建任务...”。")]),e._v(" "),t("ul",[t("li",[e._v("在常规这个页签里，名称填为“frpc”，然后勾上“不管用户是否登录都要运行”、“使用最高权限运行”、“隐藏”。")]),e._v(" "),t("li",[e._v("在触发器这个页签里，选择新建，然后开始任务选择“启动时”，可以自己选择是否重复执行以及间隔。")]),e._v(" "),t("li",[e._v("在操作这个页签里，选择新建，然后点击“浏览”选择前面创建的“start.bat”（D:\\frp_0.35.0_windows_amd64\\start.bat），最后在“起始于”里填写 start.bat 的父路径（D:\\frp_0.35.0_windows_amd64）。")]),e._v(" "),t("li",[e._v("返回常规页签，然后点击确定，输入电脑登录密码，就完成了 frpc 的自启动。")])]),e._v(" "),t("h3",{attrs:{id:"给云服务器设置安全组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#给云服务器设置安全组"}},[e._v("#")]),e._v(" 给云服务器设置安全组")]),e._v(" "),t("p",[e._v("云服务器"),t("strong",[e._v("内部")]),e._v("的 frps 依赖的"),t("code",{pre:!0},[e._v("7000")]),e._v("可以不用管，因为你在服务器命令行里输入"),t("code",{pre:!0},[e._v("firewall-cmd --state")]),e._v("，会发现阿里云服务器操作系统内的防火墙是默认关闭的，所以内部使用"),t("code",{pre:!0},[e._v("7000")]),e._v("端口可以不用管了。如果你要放开云服务器本身的防火墙并添加"),t("code",{pre:!0},[e._v("7000")]),e._v("端口，可以参考如下命令。")]),e._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# 先查看防火墙状态\nfirewall-cmd --state\n# 启用防火墙\nsystemctl start firewalld\n# 停用防火墙\nsystemctl stop firewalld\nfirewall-cmd --zone=public --add-port=7000/udp --permanent\nfirewall-cmd --zone=public --add-port=7000/tcp --permanent\n# 放行端口后要重新加载\nfirewall-cmd --reload\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("p",[e._v("而"),t("strong",[e._v("外部")]),e._v("想访问服务器以及它的一些端口，那就必须放开一些端口，这个是在"),t("a",{attrs:{href:"https://ecs.console.aliyun.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("阿里云控制台"),t("OutboundLink")],1),e._v("——网络与安全——安全组。frpc 所在机器想与云服务里的 frps 进行通信连接，需要开放云服务器安全组的"),t("code",{pre:!0},[e._v("7000")]),e._v("给外部用；然后我们要使用 RDClient 进行远程桌面控制，通过 frp 将"),t("code",{pre:!0},[e._v("3389")]),e._v("映射到云服务器的"),t("code",{pre:!0},[e._v("3360")]),e._v("端口了，那么还需要开放云服务器安全组的"),t("code",{pre:!0},[e._v("3360")]),e._v("给外部用。"),t("code",{pre:!0},[e._v("7000")]),e._v("和"),t("code",{pre:!0},[e._v("3360")]),e._v("开放给谁，也要限定好，不是谁想加就加的。")]),e._v(" "),t("p",[t("img",{attrs:{src:s(300),alt:"安全组"}})]),e._v(" "),t("p",[e._v("安全组的授权对象我们使用的是"),t("a",{attrs:{href:"https://ecs.console.aliyun.com/#/prefixList/cn-shanghai",target:"_blank",rel:"noopener noreferrer"}},[e._v("前缀列表"),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"说在最后"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#说在最后"}},[e._v("#")]),e._v(" 说在最后")]),e._v(" "),t("p",[e._v("使用 Frp 还是挺简单的，但是它的安全性还是有些差，功能上也只是反向代理、映射端口，如果想异地组网（虚拟局域网）那就不能使用 Frp 了，可以使用"),t("RouterLink",{attrs:{to:"/book-sketches/电脑工具/SoftEther实现虚拟局域网.html"}},[e._v("SoftEther 实现虚拟局域网")])],1)])}),[],!1,null,null,null);r.default=a.exports}}]);