(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{499:function(t,s,n){t.exports=n.p+"assets/img/DNS解析.1f415d17.png"},500:function(t,s){t.exports="data:image/png;base64,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"},501:function(t,s){t.exports="data:image/png;base64,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"},721:function(t,s,n){"use strict";n.r(s);var a=n(16),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"http、ajax-和跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http、ajax-和跨域"}},[t._v("#")]),t._v(" Http、Ajax 和跨域")]),t._v(" "),a("h2",{attrs:{id:"一、http-请求概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、http-请求概述"}},[t._v("#")]),t._v(" 一、Http 请求概述")]),t._v(" "),a("h3",{attrs:{id:"_1-1-输入一个-url-回车"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-输入一个-url-回车"}},[t._v("#")]),t._v(" 1.1 输入一个 URL 回车")]),t._v(" "),a("p",[t._v("在浏览器地址栏里输入一个 URL 然后按下回车，会发生以下事情：")]),t._v(" "),a("ul",[a("li",[t._v("DNS 解析，建立 TCP 连接（三次握手），发送 Http 请求。")]),t._v(" "),a("li",[t._v("server 接收 Http 请求，处理并返回。")]),t._v(" "),a("li",[t._v("客户端接收到返回数据后，处理数据（如渲染页面，执行 js）。")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-简单说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-简单说明"}},[t._v("#")]),t._v(" 1.2 简单说明")]),t._v(" "),a("p",[t._v("打开浏览器，按下"),a("code",{pre:!0},[t._v("F12")]),t._v("会打开浏览器控制台，查看控制台的"),a("code",{pre:!0},[t._v("Network")]),t._v("页签。然后在浏览器地址栏里输入"),a("code",{pre:!0},[t._v("www.baidu.com")]),t._v("并回车。")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("DNS 解析：DNS（域名系统）拿到"),a("code",{pre:!0},[t._v("https://www.baidu.com")]),t._v("，将它解析成一个"),a("strong",[t._v("IP 地址")]),t._v("，例如"),a("code",{pre:!0},[t._v("180.101.49.11:443")]),t._v("。这个 IP 地址就是百度某个服务器的 IP 地址。"),a("code",{pre:!0},[t._v("443")]),t._v("是 https 的默认端口，"),a("code",{pre:!0},[t._v("80")]),t._v("是 http 默认端口。DNS 解析是 DNS 客户端向 DNS 服务器端发送一份查询报文也就是域名等，DNS 服务器端会返回一份报文也就是 IP 地址等。")]),t._v(" "),a("p",[a("img",{attrs:{src:n(499),alt:"DNS解析"}})])]),t._v(" "),a("li",[a("p",[t._v("建立 TCP 连接：也就是三次握手。第一次握手，客户端询问服务端“你是否可用”；第二次握手，服务端告知客服端“我可用”；第三次握手，客户端告知服务端“我即将访问你”。")])]),t._v(" "),a("li",[a("p",[t._v("发送 Http 请求：大多发送的是 GET 或者 POST 请求，可以是 URL 直链请求也可以使用 ajax 异步发送请求。")])]),t._v(" "),a("li",[a("p",[t._v("server 处理请求：确认访问权限，处理好业务逻辑之后会返回响应。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// node.js处理请求")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"req.method"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"req.url"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("接收响应：客户端处理响应，比如加载返回的 js、css 文件并执行它们。")])])]),t._v(" "),a("h2",{attrs:{id:"二、xmlhttprequest-对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、xmlhttprequest-对象"}},[t._v("#")]),t._v(" 二、XMLHttpRequest 对象")]),t._v(" "),a("h3",{attrs:{id:"_2-1-xhr-的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-xhr-的使用"}},[t._v("#")]),t._v(" 2.1 XHR 的使用")]),t._v(" "),a("p",[a("strong",[t._v("Ajax")]),t._v("是"),a("code",{pre:!0},[t._v("Asynchronous JavaScript And XML")]),t._v("的缩写，表示"),a("strong",[t._v("异步")]),t._v("的 JavaScript+XML。Ajax 是一门浏览器与服务器的"),a("strong",[t._v("通信技术")]),t._v("，它的特点是"),a("strong",[t._v("无需刷新页面")]),t._v("即可从服务器取得数据（请求然后响应最后修改 DOM，无需刷新页面），它的核心是"),a("strong",[t._v("XMLHttpRequest 对象")]),t._v("（简称 XHR），前端人员可以使用这个对象进行服务器数据请求。需要注意的是，它名称虽然包含 XML，但其实与数据格式无关（可能是纯文本、XML、JSON）。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 先实例化它，原生XMLHttpRequest，没有参数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("实例化 XMLHttpRequest 之后，我们就可以准备发送一个"),a("strong",[t._v("请求")]),t._v("了，先"),a("strong",[t._v("配置")]),t._v("请求信息（仅配置），再"),a("strong",[t._v("发送")]),t._v("请求（建立连接）。")]),t._v(" "),a("ul",[a("li",[t._v("使用"),a("code",{pre:!0},[t._v("xhr.open()")]),t._v("进行"),a("strong",[t._v("配置")]),t._v("。该方法接收三个参数，第一个参数是什么类型的请求，比如是"),a("code",{pre:!0},[t._v('"GET"')]),t._v("还是"),a("code",{pre:!0},[t._v('"POST"')]),t._v("（最好都大写）；第二个参数是请求地址，比如"),a("code",{pre:!0},[t._v("http://localhost/test.txt")]),t._v("；第三个参数是是否异步发送请求，一般是"),a("code",{pre:!0},[t._v("true")]),t._v("（可以不传，默认值就是"),a("code",{pre:!0},[t._v("true")]),t._v("）。")]),t._v(" "),a("li",[a("strong",[t._v("发送")]),t._v("请求使用"),a("code",{pre:!0},[t._v("xhr.send(param)")]),t._v("，GET 请求是没有"),a("code",{pre:!0},[t._v("param")]),t._v("的，POST 是有"),a("code",{pre:!0},[t._v("param")]),t._v("的，"),a("code",{pre:!0},[t._v("param")]),t._v("是请求主体发送的数据（request body）。")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置请求信息")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost/test.txt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送请求。GET是没有param，POST是有param的，param是request body")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("发送请求过后，因为一般是异步的，所以我们要知道请求/响应到了"),a("strong",[t._v("什么阶段")]),t._v("，xhr 的"),a("code",{pre:!0},[t._v("readyState")]),t._v("属性就"),a("strong",[t._v("记录")]),t._v("这些信息：")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v("0")]),t._v("：未初识化。尚未调用"),a("code",{pre:!0},[t._v("open()")]),t._v("方法。常定义"),a("code",{pre:!0},[t._v("UNSENT = 0; // 初始状态")]),t._v("。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("1")]),t._v("：启动。已经调用"),a("code",{pre:!0},[t._v("open()")]),t._v("方法，但尚未调用"),a("code",{pre:!0},[t._v("send()")]),t._v("方法。常定义"),a("code",{pre:!0},[t._v("OPENED = 1; // open被调用")]),t._v("。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("2")]),t._v("：发送。已经调用"),a("code",{pre:!0},[t._v("send()")]),t._v("方法，但尚未接收到响应。常定义"),a("code",{pre:!0},[t._v("HEADERS_RECEIVED = 2; // 接收到response header")]),t._v("。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("3")]),t._v("：接收。已经接收到部分响应数据。常定义"),a("code",{pre:!0},[t._v("LOADING = 3; // 响应正在被加载")]),t._v("。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("4")]),t._v("：完成。已经接收到全部响应数据。常定义"),a("code",{pre:!0},[t._v("DONE = 4; // 请求完成")]),t._v("。")])]),t._v(" "),a("p",[t._v("并且"),a("code",{pre:!0},[t._v("readyState")]),t._v("的值"),a("strong",[t._v("每次变化")]),t._v("时都会触发"),a("code",{pre:!0},[t._v("readystatechange")]),t._v("事件。那前端人员就可以"),a("strong",[t._v("监听")]),t._v("这个事件，再配合"),a("code",{pre:!0},[t._v("readyState")]),t._v("的为"),a("code",{pre:!0},[t._v("4")]),t._v("，就可以判断何时去"),a("strong",[t._v("处理响应")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 已经接收到全部响应数据")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理响应")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("浏览器收到服务器的响应后，会"),a("strong",[t._v("填充")]),t._v("XHR 对象的"),a("strong",[t._v("属性")]),t._v("。相关属性如下：")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v("responseText")]),t._v("（新脚本是"),a("code",{pre:!0},[t._v("response")]),t._v("）：作为响应主体被返回的文本（不管什么数据类型）。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("responseXML")]),t._v("（这是旧脚本）：如果响应的内容类型是"),a("code",{pre:!0},[t._v("text/xml")]),t._v("或"),a("code",{pre:!0},[t._v("application/xml")]),t._v("，这个属性中将保存包含着响应数据的"),a("code",{pre:!0},[t._v("XML DOM")]),t._v("文档。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("status")]),t._v("：响应额 HTTP 状态。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("statusText")]),t._v("：HTTP 状态的说明，作为参考，一般不作为后续 js 判断。")])]),t._v(" "),a("p",[t._v("前端人员需要在响应返回后，拿到这个 XHR 对象做校验和业务逻辑处理（"),a("strong",[t._v("处理响应")]),t._v("）。校验就是判断"),a("strong",[t._v("状态码")]),t._v("也就是"),a("code",{pre:!0},[t._v("status")]),t._v("属性，是"),a("code",{pre:!0},[t._v("[200, 300)")]),t._v("以及"),a("code",{pre:!0},[t._v("304")]),t._v("都是这次请求成功的标志。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `[200, 300)`以及`304`是请求成功")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Request was unsuccessful: "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("如果在接收响应前想取消异步请求（终止请求），可以使用"),a("code",{pre:!0},[t._v("xhr.abort()")]),t._v("方法，来停止 XHR 对象的事件触发，并且不能访问到"),a("strong",[t._v("与响应有关的属性")]),t._v("。")]),t._v(" "),a("p",[t._v("因为技术的进步，"),a("code",{pre:!0},[t._v("responseText")]),t._v("和"),a("code",{pre:!0},[t._v("responseXML")]),t._v("都比较老旧了，它们常被"),a("code",{pre:!0},[t._v("response")]),t._v("替代，并且还常使用"),a("code",{pre:!0},[t._v("xhr.responseType")]),t._v("来"),a("strong",[t._v("设置响应格式")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v('""')]),t._v("：同"),a("code",{pre:!0},[t._v('"text"')]),t._v("。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v('"text"')]),t._v("：response 是 DOMString 对象中的文本。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v('"arraybuffer"')]),t._v("：response 是一个包含二进制数据的 ArrayBuffer。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v('"blob"')]),t._v("：response 是一个包含二进制数据的 Blob 对象。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v('"document"')]),t._v("：response 是一个 HTML Document 或 XML XMLDocument，根据接收到的数据的 MIME 类型而定。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v('"json"')]),t._v("：response 是通过将接收到的数据内容解析为 JSON，从而创建 js 对象。")])]),t._v(" "),a("p",[t._v("这一节最后，我们写一个"),a("strong",[t._v("比较完整")]),t._v("的例子：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置请求信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置请求信息")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/blog/xmlhttprequest/json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置响应格式，我们用常用的json格式")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送请求。GET是没有param")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听readystate的变化，readystate为4去处理响应")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// readystate为4，表示已经接收到全部响应数据，可以开始处理响应信息了")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readystate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 响应状态码status为[200, 300)以及304是请求成功")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写法一，这是旧脚本的写法")]),t._v("\n            console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xhr.responseText'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写法二，这是新脚本的写法，返回的是json并且还转为了js对象")]),t._v("\n            console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xhr.response'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Request was unsuccessful: '")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])]),a("h3",{attrs:{id:"_2-2-进度事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-进度事件"}},[t._v("#")]),t._v(" 2.2 进度事件")]),t._v(" "),a("p",[t._v("进度事件（Progress Events）定义了与客户端服务器通信有关的事件：")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v("progress")]),t._v("：在接收响应期间持续不断地触发。例如下载进度。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("error")]),t._v("：在请求发生错误时触发。例如网络中断或者无效的 URL。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("load")]),t._v("：在接收到完整的响应数据时触发。即使"),a("code",{pre:!0},[t._v("xhr.status")]),t._v("为"),a("code",{pre:!0},[t._v("400")]),t._v("或"),a("code",{pre:!0},[t._v("500")]),t._v("等。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("abort")]),t._v("：在因为调用"),a("code",{pre:!0},[t._v("abort()")]),t._v("方法而终止连接时触发。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("loadstart")]),t._v("：在接收到响应数据的第一个字节时触发。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("loadend")]),t._v("：在通信完成或触发"),a("code",{pre:!0},[t._v("error")]),t._v("、"),a("code",{pre:!0},[t._v("abort")]),t._v("或"),a("code",{pre:!0},[t._v("load")]),t._v("事件后触发。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("timeout")]),t._v("：请求超时。可以在请求发送前设置"),a("code",{pre:!0},[t._v("xhr.timeout=30000")]),t._v("。")])]),t._v(" "),a("p",[t._v("前三个用的比较多，也经常使用"),a("code",{pre:!0},[t._v("load")]),t._v("事件来"),a("strong",[t._v("替代")]),a("code",{pre:!0},[t._v("readystatechange")]),t._v("事件，当然内部还是继续搭配"),a("code",{pre:!0},[t._v("xhr.status")]),t._v("状态码判断返回结果。")]),t._v(" "),a("p",[a("code",{pre:!0},[t._v("progress")]),t._v("常用作"),a("strong",[t._v("进度指示器")]),t._v("，监听的回调函数有个 event 参数，他有三个参数，"),a("code",{pre:!0},[t._v("lengthComputable")]),t._v("、"),a("code",{pre:!0},[t._v("position")]),t._v("和"),a("code",{pre:!0},[t._v("totalSize")]),t._v("，分别表示“进度信息是否可用”、“已接收的字节数”和“根据 Content-Length 响应头部确定的预期字节数”。"),a("strong",[t._v("后两个参数")]),t._v("在现如今的 js 中应该是"),a("code",{pre:!0},[t._v("loaded")]),t._v("和"),a("code",{pre:!0},[t._v("total")]),t._v("了（意思还是一样的），"),a("code",{pre:!0},[t._v("position")]),t._v("和"),a("code",{pre:!0},[t._v("totalSize")]),t._v("可能或许还会存在。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 下载一个文件")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/blog/xmlhttprequest/load"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求收到了完整的响应")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写法一，这是旧脚本的写法")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xhr.responseText"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写法二，这是新脚本的写法")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xhr.response"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xhr.status"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xhr.statusText"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接收响应期间一直不断的触发该事件")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onprogress")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lengthComputable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写法一，这是旧脚本的写法")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Received ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" of ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("totalSize"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" bytes")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写法二，这是新脚本的写法")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Received ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loaded"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" of ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("total"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" bytes")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求失败，断网或者URL错误")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Request failed"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br")])]),a("h3",{attrs:{id:"_2-3-头部信息和-post-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-头部信息和-post-请求"}},[t._v("#")]),t._v(" 2.3 头部信息和 POST 请求")]),t._v(" "),a("p",[t._v("每个 HTTP 请求和响应都会带有一个"),a("strong",[t._v("头部信息")]),t._v("（请求头部和响应头部），我们来"),a("strong",[t._v("了解")]),t._v("一下"),a("strong",[t._v("默认的")]),t._v("浏览器头部信息：")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v("Accept")]),t._v("：浏览器能够处理的内容类型。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Accept-Charset")]),t._v("：浏览器能够显示的字符集。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Accept-Encoding")]),t._v("：浏览器能够处理的压缩编码。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Accept-Language")]),t._v("：浏览器当前设置的语言。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Connection")]),t._v("：留恋其与服务器之连接的类型。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Cookie")]),t._v("：当前页面设置的任何 Cookie。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Host")]),t._v("：发出请求的页面所在域。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Refere")]),t._v("：发出请求的页面的 URI。（HTTP 规范拼错了单词，本来应该是 referre，以规范为主）")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("User-Agent")]),t._v("：浏览器的用户代理字符串。")])]),t._v(" "),a("p",[t._v("我们"),a("strong",[t._v("不建议修改默认的浏览器头部信息")]),t._v("，但可以使用自定义的头部信息，"),a("code",{pre:!0},[t._v("xhr.setRequestHeader(xxx, yyyy)")]),t._v("，xxx 是字段名，yyy 是值。要注意的是"),a("code",{pre:!0},[t._v("setRequestHeader()")]),t._v("方法必须得在"),a("code",{pre:!0},[t._v("open()")]),t._v("和"),a("code",{pre:!0},[t._v("send()")]),t._v("之间使用。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost/test.txt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MyHeader"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MyValue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("我们可以获取响应头部信息，使用"),a("code",{pre:!0},[t._v("xhr.getResponseHeader(xxx)")]),t._v("获取单个，"),a("code",{pre:!0},[t._v("xhr.getAllResponseHeader()")]),t._v("获取全部响应头部信息。")]),t._v(" "),a("p",[a("strong",[t._v("GET 请求")]),t._v("，是将"),a("strong",[t._v("简单传参数据")]),t._v("放到了 URL 的"),a("strong",[t._v("末尾")]),t._v("，但必须经过"),a("code",{pre:!0},[t._v("encodeURIComponent()")]),t._v("进行"),a("strong",[t._v("编码")]),t._v("之后才能放到 URL 的末尾，所有的"),a("strong",[t._v("键值对儿")]),t._v("都必须由"),a("code",{pre:!0},[t._v("&")]),t._v("进行分隔。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example.php?name1=value1&name2=value2&name3=value3'")]),t._v("， "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向现有URL的末尾添加查询字符串参数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addURLParam")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 含有?那就追加&，还不含有?那就加追?")]),t._v("\n    url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'&'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 添加?或&就可以添加键值对儿了")]),t._v("\n    url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'='")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[a("strong",[t._v("POST 请求")]),t._v("，是将"),a("strong",[t._v("较为复杂数据")]),t._v("作为了"),a("strong",[t._v("请求的主体")]),t._v("提交的，这些数据大概率会被服务器保存，属于"),a("strong",[t._v("重要数据")]),t._v("。这些数据是放在"),a("code",{pre:!0},[t._v("send()")]),t._v("的入参里，数据格式通常是"),a("code",{pre:!0},[t._v("multipart/form-data")]),t._v("、"),a("code",{pre:!0},[t._v("JSON")]),t._v("、"),a("code",{pre:!0},[t._v("XML")]),t._v("。")]),t._v(" "),a("p",[t._v("特别注意，很久以前的"),a("strong",[t._v("表单数据")]),t._v("传递要设置"),a("code",{pre:!0},[t._v("xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')")]),t._v("。而在后来，定义了一个新类型"),a("strong",[t._v("FormData")]),t._v("，简化了表单数据序列化，也不用再"),a("strong",[t._v("手动设置")]),a("code",{pre:!0},[t._v("Content-Type")]),t._v("头部信息。")]),t._v(" "),a("p",[t._v("FormData 方式（其实就是"),a("code",{pre:!0},[t._v("multipart/form-data")]),t._v("）：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// FormData序列化表单，创建与表单格式相同的数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FormData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("forms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 追加新的键值对")]),t._v("\ndata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JavaScript"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"example.php"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用FormData后无需设置Content-Type头部信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送请求")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[a("code",{pre:!0},[t._v("JSON")]),t._v("形式：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 转为json字符串")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" json "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bob"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"example.php"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里不要忘了，这不同于FormData，这个得手动设置")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json; charset=utf-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h3",{attrs:{id:"_2-4-上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-上传"}},[t._v("#")]),t._v(" 2.4 上传")]),t._v(" "),a("p",[a("strong",[t._v("上传")]),t._v("请求比较特殊，它的上传进度不是"),a("code",{pre:!0},[t._v("xhr.onprogress")]),t._v("而是"),a("code",{pre:!0},[t._v("xhr.upload.onprogress")]),t._v("，并且其他常用的事件都是在"),a("code",{pre:!0},[t._v("xhr.upload")]),t._v("上。")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Document"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 文件上传 --\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token special-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onchange")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token value javascript language-javascript"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("upload")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("files"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("upload")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上传进度")]),t._v("\n        xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("upload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onprogress")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Uploaded ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loaded"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" of ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("total"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求收到了完整的响应")]),t._v("\n        xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xhr.response"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xhr.status"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xhr.statusText"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求失败")]),t._v("\n        xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Request failed"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/blog/xmlhttprequest/upload"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br")])]),a("h2",{attrs:{id:"三、跨域资源共享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、跨域资源共享"}},[t._v("#")]),t._v(" 三、跨域资源共享")]),t._v(" "),a("h3",{attrs:{id:"_3-1-cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-cors"}},[t._v("#")]),t._v(" 3.1 CORS")]),t._v(" "),a("p",[t._v("使用 Ajax 技术有个"),a("strong",[t._v("限制")]),t._v("，那就是"),a("strong",[t._v("不能跨域")]),t._v("进行请求（跨域也叫跨源），它只能访问相同"),a("strong",[t._v("域名")]),t._v("、相同"),a("strong",[t._v("端口")]),t._v("、相同"),a("strong",[t._v("协议")]),t._v("的资源（同源）。")]),t._v(" "),a("p",[a("strong",[t._v("CORS")]),t._v("（Cross-Origin Resource Sharing）是由 W3C 推出的一个"),a("strong",[t._v("基于 HTTP 头部")]),t._v("的"),a("strong",[t._v("跨域资源共享")]),t._v("技术。CORS 新增了一组的 HTTP 头部字段，存储着"),a("strong",[t._v("预检请求信息")]),t._v("或"),a("strong",[t._v("源信息")]),t._v("；CORS 也让服务器声明了哪些"),a("strong",[t._v("源站")]),t._v("有权访问哪些资源（判断标准），接收请求时服务器会拿到"),a("strong",[t._v("源信息")]),t._v("，并以这个标准作为"),a("strong",[t._v("判断依据")]),t._v("；另外，对于非简单请求会先进行"),a("strong",[t._v("预检")]),t._v("，拿到"),a("strong",[t._v("预检请求信息")]),t._v("判断是否安全标准，在通过预检后才能进行"),a("strong",[t._v("实际")]),t._v("的跨域请求。")]),t._v(" "),a("h3",{attrs:{id:"_3-2-简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-简单请求"}},[t._v("#")]),t._v(" 3.2 简单请求")]),t._v(" "),a("p",[t._v("大多浏览器是通过"),a("strong",[t._v("XMLHttpRequest 对象")]),t._v("实现了对 CORS 的"),a("strong",[t._v("原生支持")]),t._v("。如果要检测浏览器的 XHR 是否支持 CORS，可以检测 XHR 对象上是否具有"),a("code",{pre:!0},[t._v("withCredentials")]),t._v("属性（不支持 IE10 以及以前版本）。")]),t._v(" "),a("p",[a("strong",[t._v("简单请求")]),t._v("：请求方法要较为"),a("strong",[t._v("简单")]),t._v("，自定义的头部信息较为"),a("strong",[t._v("安全")]),t._v("和"),a("strong",[t._v("标准")]),t._v("。也就是大部分情况满足下面条件即可（少部分去 MDN 查）：")]),t._v(" "),a("ul",[a("li",[t._v("使用较为简单的请求方法，"),a("code",{pre:!0},[t._v("GET")]),t._v("或"),a("code",{pre:!0},[t._v("HEAD")]),t._v("或"),a("code",{pre:!0},[t._v("POST")]),t._v("。")]),t._v(" "),a("li",[t._v("自定义头部字段"),a("code",{pre:!0},[t._v("Accept")]),t._v("、"),a("code",{pre:!0},[t._v("Accept-Language")]),t._v("、"),a("code",{pre:!0},[t._v("Content-Language")]),t._v("、"),a("code",{pre:!0},[t._v("Content-Type")]),t._v("，这些字段的值要"),a("strong",[t._v("安全")]),t._v("和"),a("strong",[t._v("标准")]),t._v("。\n"),a("ul",[a("li",[t._v("其中"),a("code",{pre:!0},[t._v("Content-Type")]),t._v("字段值"),a("strong",[t._v("必须")]),t._v("是"),a("code",{pre:!0},[t._v("text/plain")]),t._v("、"),a("code",{pre:!0},[t._v("multipart/form-data")]),t._v("、"),a("code",{pre:!0},[t._v("application/x-www-form-urlencoded")]),t._v("之一。")]),t._v(" "),a("li",[t._v("至于"),a("code",{pre:!0},[t._v("Accept")]),t._v("、"),a("code",{pre:!0},[t._v("Accept-Language")]),t._v("和"),a("code",{pre:!0},[t._v("Content-Language")]),t._v("是什么标准，可以查："),a("a",{attrs:{href:"https://bugs.webkit.org/show_bug.cgi?id=165178",target:"_blank",rel:"noopener noreferrer"}},[t._v("网站 1"),a("OutboundLink")],1),t._v("、"),a("a",{attrs:{href:"https://bugs.webkit.org/show_bug.cgi?id=165566",target:"_blank",rel:"noopener noreferrer"}},[t._v("网站 2"),a("OutboundLink")],1),t._v("、"),a("a",{attrs:{href:"https://bugs.webkit.org/show_bug.cgi?id=166363",target:"_blank",rel:"noopener noreferrer"}},[t._v("网站 3"),a("OutboundLink")],1),t._v("。")])])])]),t._v(" "),a("p",[a("strong",[t._v("简单请求")]),t._v("的 HTTP 头部有个非常重要的"),a("strong",[t._v("源信息")]),t._v("，它是存储在"),a("code",{pre:!0},[t._v("Origin")]),t._v("字段里，它包含了"),a("strong",[t._v("请求页面")]),t._v("的"),a("strong",[t._v("域名")]),t._v("、"),a("strong",[t._v("端口")]),t._v("和"),a("strong",[t._v("协议")]),t._v("信息。如果服务器成功通过了这个请求，会在"),a("strong",[t._v("响应头部")]),t._v("里使用"),a("code",{pre:!0},[t._v("Access-Control-Allow-Origin")]),a("strong",[t._v("回发")]),t._v("相同的"),a("strong",[t._v("源信息")]),t._v("；如果访问的是公共资源，能被任意外域访问，那"),a("code",{pre:!0},[t._v("Access-Control-Allow-Origin")]),t._v("得值就是"),a("code",{pre:!0},[t._v("'*'")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCORSRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isAsyn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检测XHR是否支持CORS，只需判断对象上是否有withCredentials属性")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"withCredentials"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isAsyn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这是一个简单请求")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" request "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCORSRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://bar.other/resources/public-data/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[t._v("上面这个例子的简单请求的请求/响应报文可能如下：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[t._v("// 请求报文 GET /resources/public-data/ HTTP/1.1 Host: bar.other User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X\n10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre Accept:\ntext/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-us,en;q=0.5 Accept-Encoding:\ngzip,deflate Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7 Connection: keep-alive Referer:\nhttp://foo.example/examples/access-control/simpleXSInvocation.html Origin: http://foo.example // 请求的头部信息 //\n响应报文 HTTP/1.1 200 OK Date: Mon, 01 Dec 2008 00:23:53 GMT Server: Apache/2.0.61 Access-Control-Allow-Origin: * //\n访问的是公共资源 Keep-Alive: timeout=2, max=100 Connection: Keep-Alive Transfer-Encoding: chunked Content-Type:\napplication/xml [XML Data]\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h3",{attrs:{id:"_3-3-非简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-非简单请求"}},[t._v("#")]),t._v(" 3.3 非简单请求")]),t._v(" "),a("p",[a("strong",[t._v("非简单请求")]),t._v("就是除了上一节的"),a("strong",[t._v("简单请求")]),t._v("以外的一些"),a("strong",[t._v("特殊 HTTP 请求")]),t._v("，比如使用 PATCH 方法、DELETE 方法、MIME 类型的 POST 方法等。对于非简单请求，浏览器会先使用"),a("strong",[t._v("OPTIONS 方法")]),t._v("对服务器发起一个"),a("strong",[t._v("预检请求")]),t._v("，服务器对"),a("strong",[t._v("预检请求信息")]),t._v("进行检查（因为这类请求比简单请求不安全不标准，所以要预检），预检通过后服务器才会允许"),a("strong",[t._v("该源站")]),t._v("发送"),a("strong",[t._v("实际")]),t._v("的跨源请求（那就可以继续进行"),a("strong",[t._v("非简单请求")]),t._v("了），并且还告知该源站以后"),a("strong",[t._v("是否")]),t._v("需要携带身份"),a("strong",[t._v("凭证")]),t._v("（HTTP 认证相关数据和 cookie）。")]),t._v(" "),a("p",[a("strong",[t._v("预检请求")]),t._v("的头部里依然有"),a("code",{pre:!0},[t._v("Origin")]),t._v("，除了"),a("code",{pre:!0},[t._v("Origin")]),t._v("还有两个重要字段"),a("code",{pre:!0},[t._v("Access-Control-Request-Method")]),t._v("和"),a("code",{pre:!0},[t._v("Access-Control-Request-Headers")]),t._v("。")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v("Access-Control-Request-Method")]),t._v("是告知服务器之后的实际跨域请求将使用什么"),a("strong",[t._v("方法")]),t._v("（PATCH？POST？）。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Access-Control-Request-Headers")]),t._v("是告知服务器之后的实际跨域请求将携带什么"),a("strong",[t._v("自定义")]),t._v("请求"),a("strong",[t._v("头部字段")]),t._v("。")])]),t._v(" "),a("p",[t._v("同样，服务器成功通过预检请求后，返回给浏览器的"),a("strong",[t._v("响应头部")]),t._v("除了有"),a("code",{pre:!0},[t._v("Access-Control-Allow-Origin")]),t._v("之外，还有三个重要字段：")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v("Access-Control-Allow-Methods")]),t._v(": 表明服务器允许客户端使用哪些方法。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Access-Control-Allow-Headers")]),t._v(": 表明服务器允许携带那些"),a("strong",[t._v("自定义")]),t._v("请求"),a("strong",[t._v("头部字段")]),t._v("。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("Access-Control-Max-Age")]),t._v(": 是一个秒单位的数值，表明该"),a("strong",[t._v("非简单请求")]),t._v("在这个时间内"),a("strong",[t._v("不用")]),t._v("进行"),a("strong",[t._v("第二次预检")]),t._v("了。")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCORSRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isAsyn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检测XHR是否支持CORS，只需判断对象上是否有withCredentials属性")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"withCredentials"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isAsyn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 自定义了两个头部字段，并会体现在`Access-Control-Request-Headers`字段里")]),t._v("\n    xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-PINGOTHER"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pingpong"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/xml"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这是一个非简单请求")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" request "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCORSRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://bar.other/resources/post-here/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<?xml version=\"1.0\"?><person><name>Arun</name></person>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("p",[a("strong",[t._v("预检")]),t._v("的请求/响应报文")]),t._v(" "),a("div",{staticClass:"language-txt line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-txt"}},[a("code",[t._v("// 请求报文\nOPTIONS /resources/post-here/ HTTP/1.1\nHost: bar.other\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\nConnection: keep-alive\n// 源信息\nOrigin: http://foo.example\n// 告知服务器，之后实际跨域请求，它使用的是POST方式\nAccess-Control-Request-Method: POST\n// 告知服务器，之后实际跨域请求里，我会携带X-PINGOTHER和Content-Type这两个自定义头部字段\nAccess-Control-Request-Headers: X-PINGOTHER, Content-Type\n\n// 响应报文\nHTTP/1.1 200 OK\nDate: Mon, 01 Dec 2008 01:15:39 GMT\nServer: Apache/2.0.61 (Unix)\n// 源信息\nAccess-Control-Allow-Origin: http://foo.example\n// 告知客户端，之后实际跨域请求可使用POST、GET、OPTIONS方法\nAccess-Control-Allow-Methods: POST, GET, OPTIONS\n// 告知客户端，之后实际跨域请求可携带X-PINGOTHER和Content-Type这两个自定义头部字段\nAccess-Control-Allow-Headers: X-PINGOTHER, Content-Type\n// 告知客户端，该非简单请求在24小时内不用进行第二次预检了\nAccess-Control-Max-Age: 86400\nVary: Accept-Encoding, Origin\nContent-Encoding: gzip\nContent-Length: 0\nKeep-Alive: timeout=2, max=100\nConnection: Keep-Alive\nContent-Type: text/plain\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br")])]),a("p",[t._v("之后的实际"),a("strong",[t._v("跨域")]),t._v("请求/响应报文：")]),t._v(" "),a("div",{staticClass:"language-txt line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-txt"}},[a("code",[t._v('POST /resources/post-here/ HTTP/1.1\nHost: bar.other\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\nConnection: keep-alive\nX-PINGOTHER: pingpong\nContent-Type: text/xml; charset=UTF-8\nReferer: http://foo.example/examples/preflightInvocation.html\nContent-Length: 55\nOrigin: http://foo.example\nPragma: no-cache\nCache-Control: no-cache\n\n<?xml version="1.0"?><person><name>Arun</name></person>\n\n\nHTTP/1.1 200 OK\nDate: Mon, 01 Dec 2008 01:15:40 GMT\nServer: Apache/2.0.61 (Unix)\nAccess-Control-Allow-Origin: http://foo.example\nVary: Accept-Encoding, Origin\nContent-Encoding: gzip\nContent-Length: 235\nKeep-Alive: timeout=2, max=99\nConnection: Keep-Alive\nContent-Type: text/plain\n\n[Some GZIP\'d payload]\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br")])]),a("h3",{attrs:{id:"_3-4-带凭据的请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-带凭据的请求"}},[t._v("#")]),t._v(" 3.4 带凭据的请求")]),t._v(" "),a("p",[t._v("默认情况下，对于跨域 XMLHttpRequest 请求，浏览器"),a("strong",[t._v("不会")]),t._v("发送"),a("strong",[t._v("身份凭证信息")]),t._v("。如果要发送（预检结果告诉你下次请求要带凭证），可以将"),a("code",{pre:!0},[t._v("withCredentials")]),t._v("属性设置为 true，让请求携带凭证信息传给服务器。服务器也接收带凭证的请求，会将"),a("code",{pre:!0},[t._v("Access-Control-Allow-Credentials:true")]),t._v("添加到响应头部信息里。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCORSRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isAsyn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检测XHR是否支持CORS，只需判断对象上是否有withCredentials属性")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"withCredentials"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isAsyn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送的请求里携带了身份凭证信息")]),t._v("\n    xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("withCredentials "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" request "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCORSRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://bar.other/resources/credentialed-content/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])]),a("p",[t._v("而浏览器发的请求带了凭证，但服务器没有"),a("code",{pre:!0},[t._v("Access-Control-Allow-Credentials")]),t._v("，那最终 js 会获取不到这个响应信息（response 为空），并会触发 onerror 事件。")]),t._v(" "),a("h2",{attrs:{id:"四、其他跨域技术"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、其他跨域技术"}},[t._v("#")]),t._v(" 四、其他跨域技术")]),t._v(" "),a("h3",{attrs:{id:"_4-1-图像-ping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-图像-ping"}},[t._v("#")]),t._v(" 4.1 图像 Ping")]),t._v(" "),a("p",[t._v("一个网页可以从"),a("strong",[t._v("任何")]),t._v("网页中"),a("strong",[t._v("加载图像")]),t._v("，不用担心跨域问题。"),a("strong",[t._v("动态创建图像")]),t._v("，使用它们的 onload 和 onerror 事件处理程序是否接收到响应。")]),t._v(" "),a("p",[t._v("动态创建图像常使用"),a("strong",[t._v("图像 Ping")]),t._v("，请求的数据是通过查询字符串形式发送的，而响应可以是任意内容（通常是像素图或 204 响应）。不过它"),a("strong",[t._v("只能发送 GET 请求")]),t._v("，无法访问服务器的"),a("strong",[t._v("响应文本")]),t._v("，也就是说它是"),a("strong",[t._v("单向的数据传输")]),t._v("。")]),t._v(" "),a("p",[t._v("通过图像 Ping，浏览器得不到任何具体的数据，但通过侦听 load 和 error 事件，它能知道响应是什么时候接收到的。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nimg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onload "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Done!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送了一个name参数，图像Ping常用于跟踪用户点击次数")]),t._v("\nimg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.example.com/test?name=Nicholas"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h3",{attrs:{id:"_4-2-jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-jsonp"}},[t._v("#")]),t._v(" 4.2 JSONP")]),t._v(" "),a("p",[a("strong",[t._v("JSONP")]),t._v("（JSON with padding）是填充式 JSON 或参数式 JSON，讲一个回调函数追加到跨域访问的地址后面，再这个字符串放到"),a("code",{pre:!0},[t._v("<scipt>")]),t._v("标签的"),a("code",{pre:!0},[t._v("src")]),t._v("属性里，在页面加载这个"),a("code",{pre:!0},[t._v("<script>")]),t._v("时（和"),a("strong",[t._v("图像 Ping")]),t._v("类似，可从任何网址加载脚本），会对服务器发起请求，当响应达到时，回调函数会被触发，回调函数里的参数就是 response 响应数据。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"response.ip"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"response.city"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"response.region_name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("region_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reateElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将jsonp放入到跨域地址后面")]),t._v("\nscript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://freegeoip.net/json?callback=handleResponse"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstChild"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[a("strong",[t._v("JSONP")]),t._v("相比于"),a("strong",[t._v("图像 Ping")]),t._v("类，它能够直接访问响应文本（response），是"),a("strong",[t._v("双向")]),t._v("的。但如果服务器不安全，响应中可能夹带恶意代码；还有确定 JSONP 请求"),a("strong",[t._v("是否失败")]),t._v("并不容易，有可能需要定时器来监视。")]),t._v(" "),a("h3",{attrs:{id:"_4-3-comet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-comet"}},[t._v("#")]),t._v(" 4.3 Comet")]),t._v(" "),a("p",[t._v("Ajax 是页面向服务器"),a("strong",[t._v("请求")]),t._v("数据，而"),a("strong",[t._v("Comet")]),t._v("是一种服务器向页面"),a("strong",[t._v("推送")]),t._v("数据的技术。"),a("strong",[t._v("Comet")]),t._v("（服务器推送）有两种实现："),a("strong",[t._v("长轮询")]),t._v("和"),a("strong",[t._v("流")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("短轮询")]),t._v("（也叫常规轮询），浏览器定期发送"),a("strong",[t._v("请求")]),t._v("给服务器，服务器会将"),a("strong",[t._v("目前为止的数据")]),t._v("作为响应传递给浏览器（不管该数据是否有效）。服务器会一直被动接收请求，还得必须作出响应，尽管可能是无效的响应，这非常消耗服务器的性能。")]),t._v(" "),a("p",[a("img",{attrs:{src:n(500),alt:"短轮询"}})]),t._v(" "),a("p",[t._v("而"),a("strong",[t._v("长轮询")]),t._v("，浏览器发送一个请求，服务器虽然始终处于"),a("strong",[t._v("连接打开")]),t._v("，但是没有新数据是不会推送数据给浏览器，直到有新数据可发送才会去"),a("strong",[t._v("推送")]),t._v("。服务器掌握了主动权，只发送有效的数据，这很节省服务器资源。无论是短轮询还是长轮询，浏览器在接收数据之前，都会"),a("strong",[t._v("先发起")]),t._v("对服务器的连接。")]),t._v(" "),a("p",[a("img",{attrs:{src:n(501),alt:"长轮询"}})]),t._v(" "),a("p",[a("strong",[t._v("流")]),t._v("就是 HTTP 流，它在页面的整个生命周期内"),a("strong",[t._v("只")]),t._v("使用"),a("strong",[t._v("一个")]),t._v("HTTP 连接。浏览器向服务器发送一个请求，服务器就会一直保持连接打开，并周期性向浏览器推送数据。（长轮询本质还是一个个 HTTP 连接，流就只有一个，且 readyState 大部分时间是"),a("code",{pre:!0},[t._v("3")]),t._v("）。"),a("strong",[t._v("流")]),t._v("常用于服务器将输出缓存内容一次性全部发送给客户端。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createStreamingClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" progress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" finished")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" received "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理了多少个字符")]),t._v("\n  xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("substring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("received"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      received "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每次递增")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("progress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("finished")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" client "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createStreamingClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"streaming.php"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Received："')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Done!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br")])]),a("p",[t._v("管理 Comet 连接是很容易出错的，随着时间的推移，社区为 Comet 提供了两个新的 API 来完善以前的问题。")]),t._v(" "),a("h3",{attrs:{id:"_4-4-服务器发送事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-服务器发送事件"}},[t._v("#")]),t._v(" 4.4 服务器发送事件")]),t._v(" "),a("p",[a("strong",[t._v("SSE")]),t._v("（Serve-Sent Events，服务器发送事件）是用于创建服务器到浏览器的"),a("strong",[t._v("单向连接")]),t._v("，服务器可以通过这个连接发送任意数量的数据。服务器响应的 MIME 类型必须是"),a("code",{pre:!0},[t._v("text/event-strean")]),t._v("，而且数据输出要能被 js 的 API 解析。")]),t._v(" "),a("p",[t._v("使用"),a("strong",[t._v("SSE")]),t._v("时要订阅新的事件流，实例化 EventSource，并将一个 URL 作为"),a("strong",[t._v("第一个")]),t._v("参数，如果要"),a("strong",[t._v("跨域")]),t._v("那"),a("strong",[t._v("第二参数")]),t._v("应该是"),a("code",{pre:!0},[t._v("{withCredentials: true}")]),t._v("。")]),t._v(" "),a("p",[t._v("EventSource 实例对象有个"),a("code",{pre:!0},[t._v("readyState")]),t._v("属性，值为"),a("code",{pre:!0},[t._v("0")]),t._v("表示正在连接，"),a("code",{pre:!0},[t._v("1")]),t._v("表示连接成功，"),a("code",{pre:!0},[t._v("2")]),t._v("表示连接关闭了。如果你非要"),a("strong",[t._v("关闭连接")]),t._v("，可以使用"),a("code",{pre:!0},[t._v("close()")]),t._v("方法，但是你想"),a("strong",[t._v("重新使用")]),t._v("EventSource，只能"),a("strong",[t._v("重新实例化")]),t._v("EventSource（订阅新的事件流）。")]),t._v(" "),a("p",[t._v("EventSource 还有三个事件：")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v("open")]),t._v("：在建立连接时触发。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("message")]),t._v("：在从服务器接收到新事件时触发，事件回调有个"),a("code",{pre:!0},[t._v("event")]),t._v("参数，该参数有个"),a("code",{pre:!0},[t._v("data")]),t._v("属性，该属性就是服务器返回的数据（字符串）。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("eror")]),t._v("：在无法建立连接时触发。")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 异步的EventSource")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" eventSource "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventSource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/events/subscribe"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("withCredentials")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\neventSource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// json形式的：{"user":"Bob","message":"First line\\n Second line"}')]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("响应格式可能是纯文本的，最简单的情况是"),a("strong",[t._v("每个数据项")]),t._v("都带有前缀"),a("code",{pre:!0},[t._v("data:")]),t._v("，例如：")]),t._v(" "),a("div",{staticClass:"language-txt line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-txt"}},[a("code",[t._v("data: foo\n\ndata: bar\n\ndata: foo\ndata: bar\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("上面这样的文本，在之前代码的"),a("code",{pre:!0},[t._v('console.log("message", event.data)')]),t._v("，会输出三次，第一次是"),a("code",{pre:!0},[t._v("foo")]),t._v("，第二次是"),a("code",{pre:!0},[t._v("bar")]),t._v("，第三次是"),a("code",{pre:!0},[t._v("foo\\nbar")]),t._v("。"),a("code",{pre:!0},[t._v("data:")]),t._v("是相邻两行，那么它们将作为一条 message 返回，中间会插入"),a("code",{pre:!0},[t._v("\\n")]),t._v("换行符（对应服务器生成流时也只用一个"),a("code",{pre:!0},[t._v("\\n")]),t._v("）。如果"),a("code",{pre:!0},[t._v("data:")]),t._v("之间有空行，它们会作为两条 message 返回（对应服务器生成流时用两个"),a("code",{pre:!0},[t._v("\\n")]),t._v("）。")]),t._v(" "),a("p",[t._v("SSE"),a("strong",[t._v("支持")]),t._v("短轮询、长轮询和 HTTP 流，而且能在断开连接时"),a("strong",[t._v("自动确定")]),t._v("何时重新连接，服务器可设置延迟响应时间"),a("code",{pre:!0},[t._v("retry: 3000")]),t._v("。")]),t._v(" "),a("p",[t._v("为了正确地重新连接，每一条消息都应设置一个 id，具体是通过前缀"),a("code",{pre:!0},[t._v("id:")]),t._v("来给 message 添加 id 的，这个"),a("code",{pre:!0},[t._v("id: 1")]),t._v("紧挨着"),a("code",{pre:!0},[t._v("data:")]),t._v("上一行或下一行都可以。而浏览器收到带有 id 的 message 时，EventSource 实例对象会有个"),a("code",{pre:!0},[t._v("lastEventId")]),t._v("属性，它就是 id 的具体值。")]),t._v(" "),a("div",{staticClass:"language-txt line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-txt"}},[a("code",[t._v("id: 1\ndata: foo\n\ndata: bar\nid: 2\n\nid: 3\ndata: foo\ndata: bar\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("如果断开连接，会向服务器发送一个包含"),a("code",{pre:!0},[t._v("Last-Event-ID")]),t._v("字段的特殊头部的请求，以便服务器知道下一次该触发哪个事件（保证浏览器能接收到顺序正确的数据）。")]),t._v(" "),a("h3",{attrs:{id:"_4-5-web-socket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-web-socket"}},[t._v("#")]),t._v(" 4.5 Web Socket")]),t._v(" "),a("p",[a("strong",[t._v("Web Socket")]),t._v("是在一个单独的"),a("strong",[t._v("持久连接")]),t._v("上提供"),a("strong",[t._v("全双工、双向通信")]),t._v("，http 协议升级到 web socket 协议（服务器要使用专门支持这种协议的服务器）。未加密的连接不再是"),a("code",{pre:!0},[t._v("http://")]),t._v("而是"),a("code",{pre:!0},[t._v("ws://")]),t._v("；加密连接也不再是"),a("code",{pre:!0},[t._v("https://")]),t._v("而是"),a("code",{pre:!0},[t._v("wss//")]),t._v("。")]),t._v(" "),a("p",[t._v("可以对比一下 WebSocket 和 EventSource：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("WebSocket")]),t._v(" "),a("th",[t._v("EventSource")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("双向：客户端和服务端都能交换消息")]),t._v(" "),a("td",[t._v("单向：仅服务端能发送消息")])]),t._v(" "),a("tr",[a("td",[t._v("二进制和文本数据")]),t._v(" "),a("td",[t._v("仅文本数据")])]),t._v(" "),a("tr",[a("td",[t._v("WebSocket 协议")]),t._v(" "),a("td",[t._v("常规 HTTP 协议")])])])]),t._v(" "),a("p",[t._v("WebSocket 协议能让客户端与服务端之间发送非常少量的数据，而不用担心 HTTP 那样字节级的开销。由于 WebSocket 传递的"),a("strong",[t._v("数据包很小")]),t._v("，所以它非常"),a("strong",[t._v("适合移动应用")]),t._v("，可以最大程度解决宽带和网络延迟的问题。")]),t._v(" "),a("p",[t._v("使用 WebSocket，得先实例化 WebSocket，并传入连接的 URL。同源策略对 WebSocket 不适用（"),a("strong",[t._v("没有跨域限制")]),t._v("），因此可以通过它打开任何站点的连接。")]),t._v(" "),a("p",[t._v("实例化 WebSocket 后，浏览器会立马尝试创建连接。WebSocket 实例对象也有一个"),a("code",{pre:!0},[t._v("readyState")]),t._v("属性：")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v("WebSocket.CONNECTING")]),t._v("，值是"),a("code",{pre:!0},[t._v("0")]),t._v("：正在建立连接")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("WebSocket.OPEN")]),t._v("，值是"),a("code",{pre:!0},[t._v("1")]),t._v("：已经建立连接")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("WebSocket.CLOSING")]),t._v("，值是"),a("code",{pre:!0},[t._v("2")]),t._v("：正在关闭连接")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("WebSocket.CLOSED")]),t._v("，值是"),a("code",{pre:!0},[t._v("3")]),t._v("：已经关闭连接")])]),t._v(" "),a("p",[t._v("WebSocket 还有 4 个事件：")]),t._v(" "),a("ul",[a("li",[a("code",{pre:!0},[t._v("open")]),t._v("：在成功建立连接时触发。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("message")]),t._v("：在接收到数据时触发。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("error")]),t._v("：在发生错误时触发，连接不能持续了。")]),t._v(" "),a("li",[a("code",{pre:!0},[t._v("close")]),t._v("：在连接关闭时触发。")])]),t._v(" "),a("p",[t._v("使用 WebSocket 发送数据是"),a("code",{pre:!0},[t._v("send(param)")]),t._v("方法，param 就是要发送的数据，param 只能是"),a("strong",[t._v("纯文本")]),t._v("，如果是"),a("strong",[t._v("对象")]),t._v("就要使用"),a("code",{pre:!0},[t._v("JSON.stringify(param)")]),t._v("进行转换（序列化）。使用 WebSocket 接收数据，在"),a("code",{pre:!0},[t._v("message")]),t._v("事件的回调函数中，该函数的参数"),a("code",{pre:!0},[t._v("event")]),t._v("，这个"),a("code",{pre:!0},[t._v("event")]),t._v("的"),a("code",{pre:!0},[t._v("data")]),t._v("属性就是返回数据，该数据是穿文本字符串，一般使用前要经过"),a("code",{pre:!0},[t._v("JSON.parse()")]),t._v("进行转换。")]),t._v(" "),a("p",[t._v("一个较为完整的例子：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" socket "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wss://www.example.com/server.php"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 连接已建立")]),t._v("\nsocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onopen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 因为连接的建立是异步的，所以得保证连接建立了才发送请求。")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果参数是对象，要转换为JSON字符串")]),t._v("\n  socket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bob"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接收到数据")]),t._v("\nsocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回的event.data是JSON字符串，需要转换为对象")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("接收到数据：")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 连接关闭，当我们不再使用WebSocket可以关闭它：socket.close([code], [reason])")]),t._v("\nsocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onclose")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wasClean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 正常关闭，code一般为1000")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("WebSocket连接正常关闭， code=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" reason=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reason"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 服务器进程被杀死或网络中断，event.code 通常为 1006")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("WebSocket连接丢失， code=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" reason=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reason"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 连接发生错误")]),t._v("\nsocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("WebSocket发生了错误：")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);